{"version":3,"file":"define-preview-url.cjs","sources":["../src/definePreviewUrl.ts"],"sourcesContent":["import {\n  urlSearchParamPreviewPathname,\n  urlSearchParamPreviewSecret,\n} from './constants'\nimport type {\n  PreviewUrlResolver,\n  PreviewUrlResolverContext,\n  PreviewUrlResolverOptions,\n} from './types'\n\n/**\n * @internal\n */\nexport function definePreviewUrl<SanityClientType>(\n  options: PreviewUrlResolverOptions,\n): PreviewUrlResolver<SanityClientType> {\n  const {\n    draftMode,\n    origin = typeof location === 'undefined'\n      ? 'https://localhost'\n      : location.origin,\n    preview = '/',\n  } = options\n  const productionUrl = new URL(preview, origin)\n  const enableDraftModeUrl = draftMode.enable\n    ? new URL(draftMode.enable, origin)\n    : undefined\n\n  return async (context): Promise<string> => {\n    const previewUrl = new URL(\n      context.previewSearchParam || preview,\n      productionUrl,\n    )\n    if (enableDraftModeUrl) {\n      const enableDraftModeRequestUrl = new URL(enableDraftModeUrl)\n      const { searchParams } = enableDraftModeRequestUrl\n      searchParams.set(urlSearchParamPreviewSecret, context.previewUrlSecret)\n      if (previewUrl.pathname !== enableDraftModeRequestUrl.pathname) {\n        searchParams.set(urlSearchParamPreviewPathname, previewUrl.pathname)\n      }\n\n      return enableDraftModeRequestUrl.toString()\n    }\n    return previewUrl.toString()\n  }\n}\n\nexport type {\n  PreviewUrlResolver,\n  PreviewUrlResolverContext,\n  PreviewUrlResolverOptions,\n}\n"],"names":["exports","definePreviewUrl","options","draftMode","origin","location","preview","productionUrl","URL","enableDraftModeUrl","enable","async","previewUrl","context","previewSearchParam","enableDraftModeRequestUrl","searchParams","set","urlSearchParamPreviewSecret","previewUrlSecret","pathname","urlSearchParamPreviewPathname","toString"],"mappings":"sHA6CAA,QAAAC,iBAhCO,SACLC,GAEM,MAAAC,UACJA,EAAAC,OACAA,GAA6B,oBAAbC,SACZ,oBACAA,SAASD,QAAAE,QACbA,EAAU,KACRJ,EACEK,EAAgB,IAAIC,IAAIF,EAASF,GACjCK,EAAqBN,EAAUO,OACjC,IAAIF,IAAIL,EAAUO,OAAQN,QAC1B,EAEJ,OAAOO,UACL,MAAMC,EAAa,IAAIJ,IACrBK,EAAQC,oBAAsBR,EAC9BC,GAEF,GAAIE,EAAoB,CAChB,MAAAM,EAA4B,IAAIP,IAAIC,IACpCO,aAAEA,GAAiBD,EAMzB,OALaC,EAAAC,IAAIC,EAAAA,EAA6BL,EAAQM,kBAClDP,EAAWQ,WAAaL,EAA0BK,UACvCJ,EAAAC,IAAII,EAAAA,EAA+BT,EAAWQ,UAGtDL,EAA0BO,UACnC,CACA,OAAOV,EAAWU,UAAS,CAE/B"}