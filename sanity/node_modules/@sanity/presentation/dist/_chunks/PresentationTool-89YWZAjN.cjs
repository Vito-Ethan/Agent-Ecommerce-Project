"use strict";var e=require("react/jsx-runtime"),t=require("@sanity/client/csm"),n=require("@sanity/ui"),r=require("react"),i=require("sanity"),s=require("sanity/router"),o=require("styled-components"),a=require("./index-2nBOtVn-.cjs"),c=require("sanity/desk"),l=require("@sanity/groq-store"),d=require("mendoza"),u=require("@sanity/icons"),p=require("@sanity/preview-url-secret/without-secret-search-params"),h=require("framer-motion"),f=require("lodash.isequal"),m=require("@sanity/preview-url-secret/create-secret"),v=require("@sanity/preview-url-secret/define-preview-url"),g=require("suspend-react");function x(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var y=x(o),w=x(f);let b;const j=new Uint8Array(16);function S(){if(!b&&(b="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!b))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return b(j)}const k=[];for(let e=0;e<256;++e)k.push((e+256).toString(16).slice(1));var C={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function P(e,t,n){if(C.randomUUID&&!t&&!e)return C.randomUUID();const r=(e=e||{}).random||(e.rng||S)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return k[e[t+0]]+k[e[t+1]]+k[e[t+2]]+k[e[t+3]]+"-"+k[e[t+4]]+k[e[t+5]]+"-"+k[e[t+6]]+k[e[t+7]]+"-"+k[e[t+8]]+k[e[t+9]]+"-"+k[e[t+10]]+k[e[t+11]]+k[e[t+12]]+k[e[t+13]]+k[e[t+14]]+k[e[t+15]]}(r)}const E=1e3,I=3e3,M=["channel/disconnect","channel/response"],D=["handshake/syn","handshake/syn-ack","handshake/ack"],z=e=>Boolean(e)&&"object"==typeof e&&!Array.isArray(e),_=e=>M.some((t=>t===e)),T=e=>D.some((t=>t===e)),L=e=>"channel/heartbeat"===e;function R(e){const t=window.self!==window.top,n=e.connections.map((e=>({buffer:[],config:e,heartbeat:null,id:null,status:"fresh"})));function r(e){e.heartbeat&&window.clearInterval(e.heartbeat)}function i(t,n){const i=t.status;i!==n&&(t.status=n,e.onStatusUpdate?.(n,i,t),"connected"===n&&(function(e){const t=[...e.buffer];e.buffer.splice(0,e.buffer.length),t.forEach((({type:t,data:n})=>{s(e,t,n)}))}(t),function(e){if(r(e),e.config.heartbeat){const t="number"==typeof e.config.heartbeat?e.config.heartbeat:I;e.heartbeat=window.setInterval((()=>{c("channel/heartbeat",void 0,[e])}),t)}}(t)),"disconnected"===n&&r(t))}function s(t,r,i){return new Promise(((s,o)=>{const a={id:P(),type:r,connectionId:t.id,from:e.id,to:t.config.id,data:i},c=_(r),l=T(r),d=L(r),u=n.find((e=>e.id===t.id&&"connected"===e.status));if(c||l||d||u){if(!c||d){const n=setTimeout((()=>{a.connectionId===t.id?o({reason:`Received no response to message '${a.id}' on client '${e.id}'`,msg:a,connection:t}):s(a.id)}),E),r=e=>{const{data:t}=e;"channel/response"===t.type&&t.data?.responseTo&&t.data.responseTo===a.id&&(window.removeEventListener("message",r,!1),clearTimeout(n),s(a.id))};window.addEventListener("message",r,!1)}try{const e=l?"*":t.config.targetOrigin;return t.config.target.postMessage(a,{targetOrigin:e}),void((c||l)&&s(a.id))}catch(n){console.error("Failed to postMessage",n,{msg:a,connection:t}),o({reason:`Failed to postMessage '${a.id}' on client '${e.id}'`,msg:a,connection:t})}}"fresh"!==t.status&&"connecting"!==t.status||(t.buffer.push({type:r,data:i}),s(a.id)),o({reason:`Will not send message '${a.id}' on client '${e.id}'`,msg:a,connection:t})}))}function o(e,t,n){return Promise.allSettled(e.map((e=>s(e,t,n))))}function a(t){const r=function(t){const{source:r,origin:i,data:s}=t;if(z(s))return n.find((t=>e.id===s.to&&t.config.id===s.from&&t.config.target===r&&(t.config.targetOrigin===i||"*"===t.config.targetOrigin)&&(t.id===s.connectionId||T(s.type))))}(t);if(!r)return;const{data:o}=t;if(T(o.type))!function(e,t){if("handshake/syn"===t.data.type){const n=t.data.data?.id||e.id;e.id=n,s(e,"handshake/syn-ack",{id:n})}if("handshake/syn-ack"===t.data.type){const n=t.data.data?.id||e.id;e.id=n,i(e,"connected"),s(e,"handshake/ack",{id:n})}if("handshake/ack"===t.data.type){const n=t.data.data?.id||e.id;e.id=n,i(e,"connected")}}(r,t);else if("channel/disconnect"===o.type)i(r,"disconnected");else if("channel/response"===o.type);else{const t=[o.type,o.data];e.handler(...t),s(r,"channel/response",{responseTo:o.id})}}async function c(e,t,r){const s=await o(r||n,e,t);return s.forEach((e=>{if("rejected"===e.status){const t=n.find((t=>"connected"===t.status&&t.id===e.reason.connection.id));t&&i(t,"unhealthy")}})),s}return function(){window.addEventListener("message",a,!1);const e=n.filter((e=>["disconnected","fresh","unhealthy"].includes(e.status)));Promise.all(e.map((e=>(i(e,"connecting"),s(e,"handshake/syn",{id:P()})))))}(),{disconnect:function(){window.removeEventListener("message",a,!1);const e=n.filter((({status:e})=>"connecting"===e||"connected"===e));e.length&&(o(e,"channel/disconnect"),e.forEach((e=>{i(e,"disconnected")})))},inFrame:t,send:c}}function $(e){return null!==e&&Array.isArray(e)}const O=/^([A-Za-z]+):([0-9]+)$/,F=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,U=/^([A-Za-z]+):([a-z0-9]+)$/;function q(e){const t=[];for(const n of e.split(".")){const e=O.exec(n);if(e){t.push(e[1],Number(e[2]));continue}const r=F.exec(n);if(r){t.push(r[1],[Number(r[2]),Number(r[3])]);continue}const i=U.exec(n);i?t.push(i[1],{_key:i[2]}):t.push(n)}return t}const N={alt:"altKey",ctrl:"ctrlKey",mod:"undefined"!=typeof window&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function B(e,t){return e.every((e=>N[e]?t[N[e]]:t.key===e.toUpperCase()))}function W(e){return"Alt"===e.key}function K(t){const{children:r,message:i,onRetry:s,...o}=t;return e.jsx(n.Card,{height:"fill",...o,children:e.jsx(n.Flex,{align:"center",height:"fill",justify:"center",children:e.jsx(n.Container,{padding:4,sizing:"border",width:0,children:e.jsxs(n.Stack,{space:4,children:[e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Text,{size:1,weight:"semibold",children:"An error occured"}),e.jsx(n.Text,{muted:!0,size:1,children:i})]}),r,s&&e.jsx(n.Box,{children:e.jsx(n.Button,{fontSize:1,mode:"ghost",onClick:s,text:"Retry"})})]})})})})}function A(){const e=r.useContext(a.P);if(!e)throw new Error("Presentation context is missing");return e}function J(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(e={}){const t=Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&");return t.length?`?${t}`:""}(Object.entries(e).filter((([e])=>t.includes(e))).reduce(((e,[t,n])=>null==n?e:{...e,[t]:n}),{}))}const V=r.forwardRef((function(t,n){const{deskParams:r,params:i}=A();return e.jsx(s.StateLink,{...t,ref:n,state:{type:void 0,_searchParams:Object.entries({...r,preview:i.preview})},title:void 0})})),G=r.forwardRef((function(t,n){const{documentId:r,documentType:i,...o}=t;return e.jsx(s.StateLink,{...o,ref:n,state:{path:r,type:i},title:void 0})}));function Q(t){const{children:n,params:o,onDeskParams:a,previewUrl:l,refs:d}=t,{state:u,resolvePathFromState:p}=s.useRouter(),h=i.useUnique(Object.fromEntries(u._searchParams||[])),f=r.useCallback((e=>`${p(u)}${J({...h,...e})}`),[p,h,u]),m=r.useMemo((()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:o,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:t=>{const{childId:n,...r}=t,o=d?.find((e=>i.getPublishedId(e._id)===n));return o?e.jsx(s.StateLink,{...r,state:{path:o._id,type:o._type,_searchParams:Object.entries({preview:l})}}):e.jsx("div",{...r})},BackLink:V,ReferenceChildLink:G,ParameterizedLink:()=>e.jsx(e.Fragment,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:e=>{console.warn("handleEditReference",e)},replaceCurrent:e=>{console.warn("replaceCurrent",e)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:e=>{console.warn("duplicateCurrent",e)},setView:e=>{console.warn("setView",e)},setParams:e=>{a({...e,inspect:e.inspect??void 0})},setPayload:e=>{console.warn("setPayload",e)},navigateIntent:(e,t,n)=>{console.warn("navigateIntent",e,t,n)},createPathWithParams:f})),[f,a,o,l,d]);return e.jsx(c.PaneRouterContext.Provider,{value:m,children:n})}const H=y.default(c.PaneLayout)`
  height: 100%;
`,X=y.default(n.Flex)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,Z=y.default(n.Code)`
  white-space: pre-wrap;
`;function Y(t){const{onDeskParams:i,previewUrl:s,refs:o}=t,{devMode:a}=A(),l=r.useMemo((()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:o.map((e=>e._id))}},schemaTypeName:"",title:"Documents on this page",type:"documentList"})),[o]),[d,u]=r.useState(null),p=r.useCallback((()=>u(null)),[]),h=r.useMemo((()=>({})),[]);return r.useEffect((()=>u(null)),[o]),d?e.jsx(K,{flex:1,message:"Could not render the document list",onRetry:p,children:a&&e.jsx(n.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Error message"}),e.jsx(Z,{size:1,children:d.error.message})]})})}):e.jsx(n.ErrorBoundary,{onCatch:u,children:e.jsx(H,{children:e.jsx(c.DeskToolProvider,{children:e.jsx(Q,{params:h,onDeskParams:i,previewUrl:s,refs:o,children:e.jsx(X,{direction:"column",flex:1,children:e.jsx(c.DocumentListPane,{index:0,itemId:"$root",pane:l,paneKey:"$root"})})})})})})}function ee(t){const{onDeskParams:n,previewUrl:r,refs:i}=t;return e.jsx(Y,{onDeskParams:n,previewUrl:r,refs:i})}const te=y.default(n.Code)`
  white-space: pre-wrap;
`;function ne(t){const{documentId:i,documentType:s,params:o,onDeskParams:a,onFocusPath:l}=t,{devMode:d}=A(),u=r.useMemo((()=>({id:i,options:{id:i,type:s},title:"",type:"document"})),[i,s]),[p,h]=r.useState(null),f=r.useCallback((()=>h(null)),[]);r.useEffect((()=>{h(null)}),[i,s,o]);const{setLayoutCollapsed:m}=c.useDeskTool(),v=r.useCallback((()=>m(!0)),[m]),g=r.useCallback((()=>m(!1)),[m]);return p?e.jsx(K,{flex:1,message:"Could not render the document editor",onRetry:f,children:d&&e.jsx(n.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Error message"}),e.jsx(te,{size:1,children:p.error.message})]})})}):e.jsx(n.ErrorBoundary,{onCatch:h,children:e.jsx(c.PaneLayout,{style:{height:"100%"},onExpand:g,onCollapse:v,children:e.jsx(Q,{onDeskParams:a,params:o,children:e.jsx(c.DocumentPane,{paneKey:"document",index:1,itemId:"document",pane:u,onFocusPath:l})})})})}function re(t){const{deskParams:n,documentId:s,documentType:o,onDeskParams:a,onFocusPath:l,onDocumentChange:d}=t,u=i.useEditState(s,o),p=u.draft||u.published;r.useEffect((()=>d(p)),[p,d]);const h=r.useCallback((e=>{p?._id&&l(p._id,e)}),[p,l]);return e.jsx(c.DeskToolProvider,{children:e.jsx(ne,{documentId:s,documentType:o,params:n,onDeskParams:a,onFocusPath:h})})}function ie(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:s,onFocusPath:o,onDocumentChange:a,previewUrl:c,refs:l}=t;return r&&i?e.jsx(re,{deskParams:n,documentId:r,documentType:i,onDeskParams:s,onFocusPath:o,onDocumentChange:a}):e.jsx(ee,{onDeskParams:s,previewUrl:c,refs:l})}const se=r.createContext(null);r.createContext(null);const oe=r.createContext(!1);let ae=!1;function ce(e,n,r,i,s,o){if("raw"===s)throw new Error("turboChargeResultIfSourceMap does not support raw perspective");return t.applySourceDocuments(i,o,(t=>{if(t._projectId)return void(ae||(console.warn("Cross dataset references are not supported yet, ignoring source document",t),ae=!0));if(e?._id===t._id&&e?._type===t._type)return e;const i=l.unstable__getDocumentCacheKey({projectId:n,dataset:r,perspective:s},t);return l.unstable__documentsCache.get(i)}))}function le(e,t,n){return`${e}-${t}-${JSON.stringify(n)}`}const de=r.memo((function(t){const{liveDocument:n,children:i,client:s,refreshInterval:o=2e3,perspective:a}=t;if("raw"===a)throw new Error("LiveStoreProvider does not support the raw perspective");const[c,l]=r.useState([]),[d]=r.useState((()=>new Map)),u=function(e){const[t]=r.useState((()=>new Map)),n=r.useCallback(((n,r,i,s,o)=>{t.has(n)||(t.set(n,{perspective:r,query:i,params:s,listeners:new Set}),e((e=>e.includes(n)?e:[...e,n])));const a=t.get(n);if(!a||!a.listeners)throw new TypeError("Inconsistent cache for key: "+n);const{listeners:c}=a;return c.add(o),()=>{c.delete(o),0===c.size&&(t.delete(n),e((e=>e.includes(n)?e.filter((e=>e!==n)):e)))}}),[t,e]);return r.useMemo((()=>({cache:t,subscribe:n})),[t,n])}(l),[p]=r.useState((()=>function(e,t,n){const r=le(a,t,n);return{subscribe:e=>{const i=u.subscribe(r,a,t,n,e);return()=>i()},getSnapshot:()=>d.get(r)}})),[h,f]=r.useState([]),m=r.useCallback((e=>{const t=new Set;if(e.documents?.length)for(const{_id:n}of e.documents)t.add(n);f((e=>{const n=Array.from(new Set([...e,...t]));return JSON.stringify(n.sort())===JSON.stringify(e.sort())?e:n}))}),[]);return e.jsxs(se.Provider,{value:p,children:[e.jsx(oe.Provider,{value:!0,children:i}),e.jsx(fe,{liveDocument:n,cache:u.cache,client:s,setTurboIds:f,snapshots:d,turboIds:h,perspective:a}),c.map((t=>{if(!u.cache.has(t))return null;const{query:r,params:i,listeners:c}=u.cache.get(t);return e.jsx(pe,{liveDocument:n,client:s,listeners:c,params:i,query:r,refreshInterval:o,snapshots:d,turboIdsFromSourceMap:m,perspective:a},t)}))]})}));de.displayName="LiveStoreProvider";var ue=de;const pe=r.memo((function(e){const{liveDocument:t,client:n,refreshInterval:i,query:s,params:o,listeners:a,snapshots:c,turboIdsFromSourceMap:l,perspective:d}=e,{projectId:u,dataset:p}=r.useMemo((()=>{const{projectId:e,dataset:t}=n.config();return{projectId:e,dataset:t}}),[n]),[h,f]=r.useState(null);if(h)throw h;const[m,v]=function(e){const{refreshInterval:t}=e,n=function(){const[e,t]=r.useState(!1);r.useEffect((()=>{t(navigator.onLine);const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e),window.addEventListener("offline",n),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}),[]);const n=r.useSyncExternalStore(he,(()=>document.visibilityState),(()=>"hidden"));if(!e)return!0;if("hidden"===n)return!0;return!1}(),[i,s]=r.useState("hit"),o=r.useCallback((()=>(s("inflight"),()=>s("hit"))),[]);return r.useEffect((()=>{if(!t||"hit"!==i)return;const e=setTimeout((()=>s("stale")),t);return()=>clearTimeout(e)}),[t,i]),r.useEffect((()=>{if("hit"!==i)return;const e=()=>s("stale");return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)}),[t,i]),r.useEffect((()=>{n&&"hit"===i&&s("stale"),n||"stale"!==i||s("refresh")}),[n,i]),[i,o]}({refreshInterval:i}),g="refresh"===m||"inflight"===m;return r.useEffect((()=>{if(!g)return;let e=!1;const r=new AbortController;const i=v();return async function(){const{signal:i}=r,{result:h,resultSourceMap:f}=await n.fetch(s,o,{tag:"presentation-loader",signal:i,perspective:d,filterResponse:!1});if(!i.aborted){c.set(le(d,s,o),{result:f?ce(t,u,p,h,d,f):h,resultSourceMap:f}),f&&l(f);for(const e of a.values())e();e=!0}}().catch((e=>{"AbortError"!==e.name&&f(e)})).finally(i),()=>{e||r.abort()}}),[t,n,p,a,o,u,s,g,c,v,l,d]),null}));function he(e){return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)}pe.displayName="QuerySubscription";const fe=r.memo((function(t){const{liveDocument:n,client:i,snapshots:s,cache:o,turboIds:a,setTurboIds:c,perspective:u}=t,{projectId:p,dataset:h}=r.useMemo((()=>{const{projectId:e,dataset:t}=i.config();return{projectId:e,dataset:t}}),[i]);r.useEffect((()=>{const e=new Set;for(const{perspective:t,query:n,params:r}of o.values()){const i=le(t,n,r),o=s.get(i);if(o&&o.resultSourceMap?.documents?.length)for(const{_id:t}of o.resultSourceMap.documents)e.add(t)}const t=[...e].sort();JSON.stringify(a)!==JSON.stringify(t)&&c(t)}),[o,c,s,a]);const[f,m]=r.useState([]);r.useEffect((()=>{const e=new Set(f.flat()),t=new Set;for(const n of a)e.has(n)||l.unstable__documentsCache.has(l.unstable__getDocumentCacheKey({projectId:p,dataset:h,perspective:u},{_id:n}))||t.add(n);const n=[...t].slice(0,10);0!==n.length&&m((e=>[...e.slice(-10),n]))}),[f,h,u,p,a]);const[v,g]=r.useState();r.useEffect((()=>{const e=i.listen("published"===u?'*[!(_id in path("drafts.**"))]':'*[_id in path("drafts.**")]',{},{events:["mutation"],effectFormat:"mendoza",includePreviousRevision:!1,includeResult:!1,tag:"presentation-loader"}).subscribe((e=>{if("mutation"!==e.type||!e.effects?.apply?.length)return;const t=l.unstable__getDocumentCacheKey({projectId:p,dataset:h,perspective:u},{_id:e.documentId}),n=l.unstable__documentsCache.peek(t);if(n){const r={...n};delete r._rev;const i=d.applyPatch(r,e.effects.apply);l.unstable__documentsCache.set(t,i)}g(e.documentId)}));return()=>e.unsubscribe()}),[i,h,u,p]),r.useEffect((()=>{if(!v||!a.includes(v))return;const e=[];for(const[t,r]of s.entries())r.resultSourceMap?.documents?.length&&(r.result=ce(n,p,h,r.result,u,r.resultSourceMap),e.push(t));for(const t of e){const e=o.get(t)?.listeners;if(e)for(const t of e)t()}g(void 0)}),[n,o,h,v,u,p,s,a]);const[x,y]=r.useState();return r.useEffect((()=>{if(!x)return;const e=[];for(const[t,r]of s.entries())r.resultSourceMap?.documents?.length&&(r.result=ce(n,p,h,r.result,u,r.resultSourceMap),e.push(t));for(const t of e){const e=o.get(t)?.listeners;if(e)for(const t of e)t()}}),[o,h,n,x,u,p,s]),r.useEffect((()=>{n&&y(n._rev)}),[n]),e.jsx(e.Fragment,{children:f.map((t=>e.jsx(me,{client:i,projectId:p,dataset:h,ids:t,perspective:u},JSON.stringify(t))))})}));fe.displayName="Turbo";const me=r.memo((function(e){const{client:t,projectId:n,dataset:i,ids:s,perspective:o}=e;return r.useEffect((()=>{const e=s.filter((e=>!l.unstable__documentsCache.has(l.unstable__getDocumentCacheKey({projectId:n,dataset:i,perspective:o},{_id:e}))));0!==e.length&&t.getDocuments(e).then((e=>{for(const t of e)t&&t?._id&&l.unstable__documentsCache.set(l.unstable__getDocumentCacheKey({projectId:n,dataset:i,perspective:o},t),t)}),console.error)}),[t,i,s,o,n]),null}));function ve(e,t,n){const i=r.useContext(se);if(!i)throw new Error("useLiveQuery must be used inside a <LiveQueryProvider />");const s=function(e){const t=r.useMemo((()=>JSON.stringify(e||{})),[e]);return r.useMemo((()=>JSON.parse(t)),[t])}(n),o=r.useMemo((()=>i(e,t,s)),[i,e,s,t]),[a]=r.useState((()=>{if(void 0===e)throw new Error("initialSnapshot can't be undefined, if you don't want an initial value use null instead");try{return JSON.parse(JSON.stringify(e))}catch(t){return console.warn("Failed to deep clone initialSnapshot, this is likely an error and an indication that the snapshot isn't JSON serializable",{initialSnapshot:e,error:t}),e}})),c=r.useCallback((()=>a),[a]);return r.useSyncExternalStore(o.subscribe,o.getSnapshot,c)}function ge(t){const{activePerspective:n,liveDocument:s,channel:o,perspective:a,liveQueries:c}=t,l=i.useClient({apiVersion:"2023-10-16"}),d=r.useMemo((()=>l.config()),[l]),u=r.useMemo((()=>l.withConfig({perspective:a,resultSourceMap:"withKeyArraySelector"})),[a,l]);return r.useEffect((()=>{if(o&&n){const{projectId:e,dataset:t}=d;o.send("loader/perspective",{projectId:e,dataset:t,perspective:a})}}),[n,o,d,a]),e.jsx(ue,{liveDocument:s,client:u,perspective:a,refreshInterval:n?2e3:0,children:Object.entries(c).map((([t,{query:n,params:r}])=>e.jsx(xe,{projectId:d.projectId,dataset:d.dataset,perspective:a,query:n,params:r,channel:o},`${t}${a}`)))})}function xe(e){const{projectId:t,dataset:n,perspective:i,query:s,params:o,channel:a}=e,c=ve(null,s,o),l=c?.result,d=c?.resultSourceMap;return r.useEffect((()=>{d&&a.send("loader/query-change",{projectId:t,dataset:n,perspective:i,query:s,params:o,result:l,resultSourceMap:d})}),[a,n,o,i,t,s,l,d]),null}me.displayName="GetDocuments";const ye=r.createContext(null);ye.displayName="PanelsContext";const we=y.default.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,be=function({children:t,defaultSize:n=null,id:i,minWidth:s,maxWidth:o,order:a=0}){const c=r.useContext(ye);if(null===c)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:l,registerElement:d,unregisterElement:u}=c,p=l(i);return r.useLayoutEffect((()=>(d(i,{id:i,type:"panel",defaultSize:n,maxWidth:o??null,minWidth:s??0,order:a}),()=>{u(i)})),[i,n,a,o,s,d,u]),e.jsx(we,{style:p,children:t})};const je=y.default.div`
  position: relative;
`,Se=y.default.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:e})=>e?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-shadow-outline-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:e})=>!e&&"\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  "}
`,ke=function({id:t,order:n,disabled:i=!1}){const s=r.useRef(null),o=r.useContext(ye);if(null===o)throw Error("Panel components must be rendered within a PanelGroup container");const a=function(e){return r.useRef(e||P()).current}(t),{activeResizer:c,drag:l,startDragging:d,stopDragging:u,registerElement:p,unregisterElement:h}=o,f=c===a;if(null===o)throw Error("Panel components must be rendered within a PanelGroup container");const m=r.useCallback((e=>{d(a,e.nativeEvent)}),[a,d]),v=r.useCallback((e=>{l(a,e)}),[a,l]),g=r.useCallback((()=>{s.current.blur(),u()}),[u]);return r.useEffect((()=>{if(f&&!i)return window.addEventListener("mousemove",v),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",g)}}),[i,f,v,g]),r.useLayoutEffect((()=>(p(a,{id:a,order:n,type:"resizer",el:s}),()=>{h(a)})),[a,n,p,h]),e.jsx(je,{onMouseDown:m,ref:s,children:e.jsxs(Se,{$disabled:i,children:[e.jsx("span",{}),e.jsx("span",{})]})})};function Ce(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(e,r)}),t)}}const Pe="presentation/panels",Ee=()=>JSON.parse(localStorage.getItem(Pe)||"{}"),Ie=e=>e.map((e=>[e.id,e.order].join(":"))).join(",");function Me(){return r.useMemo((()=>{const e=(e,t)=>{(e=>{localStorage.setItem(Pe,JSON.stringify(e))})({...Ee(),[Ie(e)]:t})};return{get:e=>Ee()[Ie(e)],set:e,setDebounced:Ce(e,100)}}),[])}function De(e,t,n){const{maxWidth:r,minWidth:i}=e,s=null==r?100:r/n*100,o=i/n*100;return Math.min(s,Math.max(o,t))}function ze(e,t,n){if(1===e.length)return"100";const r=n[e.findIndex((e=>e.id===t))];return null==r?"0":r.toPrecision(10)}function _e(e,t,n=0,r=null){return e.clientX-(r||t.getBoundingClientRect()).left-n}function Te(e){return"panel"===e.type}function Le(e){return"resizer"===e.type}function Re(e){return Array.from(e.values()).sort((({order:e},{order:t})=>null==e&&null==t?0:null==e?-1:null==t?1:e-t))}function $e(e,t,n){const r=t.reduce(((e,t)=>e+t),0),i=[...t].map((e=>e/r*100));let s=0;for(let t=0;t<e.length;t++){const r=e[t],o=i[t],a=De(r,o,n);o!=a&&(s+=o-a,i[t]=a)}if("0.000"!==s.toFixed(3))for(let t=0;t<e.length;t++){const r=e[t];let{maxWidth:o,minWidth:a}=r;a=a/n*100,null!=o&&(o=o/n*100);const c=Math.min(null!=o?o:100,Math.max(a,i[t]+s));if(c!==i[t]&&(s-=c-i[t],i[t]=c,"0.000"===Math.abs(s).toFixed(3)))break}return i}const Oe=y.default.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,Fe=function({children:t}){const n=r.useRef(null),[i,s]=r.useState(new Map),o=r.useMemo((()=>Re(i).filter(Te)),[i]),[a,c]=r.useState([]),[l,d]=r.useState(null),u=r.useRef({elements:i,panels:o,widths:a}),p=r.useCallback((e=>({flexGrow:ze(o,e,a),pointerEvents:null===l?void 0:"none"})),[l,o,a]),h=r.useCallback(((e,t)=>{s((n=>{if(n.has(e))return n;const r=new Map(n);return r.set(e,t),r}))}),[]),f=r.useCallback((e=>{s((t=>{if(!t.has(e))return t;const n=new Map(t);return n.delete(e),n}))}),[]),m=r.useRef({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),v=r.useCallback(((e,t)=>{const n=Re(i),r=n.findIndex((t=>t.id===e)),s=i.get(e);if(!s||!Le(s))return;const o=s.el.current;o&&(m.current={resizerIndex:r,panelBefore:n.reduce(((e,t,n)=>Te(t)&&n<r?t:e),null),panelAfter:n.reduce(((e,t,n)=>null===e&&Te(t)&&n>r?t:e),null),containerWidth:window.innerWidth,startX:t.pageX,dragOffset:_e(t,o),resizerRect:o.getBoundingClientRect(),widths:u.current.widths},d(e))}),[i]),g=r.useCallback((()=>{d(null)}),[]),x=r.useCallback(((e,t)=>{t.preventDefault(),t.stopPropagation();const{containerWidth:r,dragOffset:s,panelBefore:o,panelAfter:a,resizerRect:l}=m.current;if(null==o||null==a)return;const d=i.get(e);if(!d||!Le(d))return;const p=d.el.current;if(!p)return;const h=_e(t,p,s,l);if(0===h)return;const{widths:f}=u.current,v=function(e,t,n,r,i,s){const{panels:o,widths:a}=i,{widths:c}=s,l=c||a,d=[...l];{const i=e<0?r:n,s=l[o.findIndex((e=>e.id===i.id))],a=De(i,s+Math.abs(e),t);if(s===a)return l;e=e<0?s-a:a-s}let u=0,p=e<0?n:r,h=o.findIndex((e=>e.id===p.id));for(;;){const n=o[h],r=l[h],i=De(n,r-(Math.abs(e)-Math.abs(u)),t);if(r!==i&&(u+=r-i,d[h]=i,u.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--h<0)break}else if(++h>=o.length)break}return 0===u?l:(p=e<0?r:n,h=o.findIndex((e=>e.id===p.id)),d[h]=l[h]+u,d)}(h/n.current.getBoundingClientRect().width*100,r,o,a,u.current,m.current),g=f.some(((e,t)=>e!==v[t]));g&&c(v)}),[i]);r.useLayoutEffect((()=>{u.current.elements=i,u.current.panels=o,u.current.widths=a}),[i,o,a]);const y=Me();r.useLayoutEffect((()=>{const{widths:e}=u.current;if(e.length===o.length)return;const t=y.get(o);if(t){const e=$e(o,t,window.innerWidth);return void c(e)}const n=function(e){let t=e.length,n=100;const r=e.map((e=>e.defaultSize?(n-=e.defaultSize,t-=1,e.defaultSize):null)),i=n/t;return r.map((e=>null===e?i:e))}(o);c(n)}),[y,o]),r.useEffect((()=>{a.length&&y.setDebounced(o,a)}),[y,o,a]),r.useLayoutEffect((()=>{const e=new ResizeObserver((()=>{const{panels:e,widths:t}=u.current,n=$e(e,t,window.innerWidth),r=t.some(((e,t)=>e!==n[t]));r&&c(n)}));return e.observe(n.current),()=>{e.disconnect()}}),[]);const w=r.useMemo((()=>({activeResizer:l,drag:x,getPanelStyle:p,registerElement:h,startDragging:v,stopDragging:g,unregisterElement:f})),[l,x,p,h,v,g,f]);return e.jsx(ye.Provider,{value:w,children:e.jsx(Oe,{ref:n,children:t})})};function Ue(e){const{id:t,type:n}=e;return i.useEditState(t,n),null}const qe=function(t){const{children:n,setParams:i}=t,s=r.useCallback((e=>{i({preview:e})}),[i]),o=r.useMemo((()=>s),[s]);return e.jsx(a.a.Provider,{value:o,children:n})},Ne=function(t){const{children:n,params:i}=t,s=r.useMemo((()=>i),[i]);return e.jsx(a.b.Provider,{value:s,children:n})},Be=function(t){const{children:n,deskParams:i,devMode:s,name:o,params:c,setParams:l}=t,d=r.useMemo((()=>({deskParams:i,devMode:s,name:o,params:c,setParams:l})),[i,s,o,c,l]);return e.jsx(a.P.Provider,{value:d,children:n})},We=h.motion(y.default.iframe`
  border: 0;
  max-height: 100%;
  width: 100%;
  display: block;
`),Ke=function(t){const{fontSize:i=1,onChange:s,origin:o,padding:a=3,value:c}=t,l=r.useRef(null),[d,p]=r.useState(void 0),[h,f]=r.useState(void 0),m=r.useCallback((e=>{p(e.currentTarget.value)}),[]),v=r.useCallback((e=>{if("Enter"===e.key){if(void 0===d)return;const e=d.startsWith("/")||""===d?`${o}${d}`:d;if(!e.startsWith(o+"/")&&e!==o)return void f(`URL must start with ${o}`);const t=e===o?o+"/":e;f(void 0),p(void 0),s(t.slice(o.length)),l.current?.blur()}"Escape"===e.key&&(f(void 0),p(void 0))}),[s,o,d]),g=r.useCallback((()=>{f(void 0),p(void 0)}),[]);r.useEffect((()=>{f(void 0),p(void 0)}),[o,c]);const x=r.useMemo((()=>({icon:u.ResetIcon})),[]);return e.jsx(e.Fragment,{children:e.jsx(n.TextInput,{clearButton:h?x:void 0,customValidity:h,fontSize:i,onBlur:g,onClear:()=>{f(void 0),p(o+c)},onChange:m,onKeyDownCapture:v,padding:a,style:{zIndex:1},radius:2,ref:l,space:a,suffix:e.jsx(n.Box,{padding:1,style:{lineHeight:0,zIndex:-1},children:e.jsx(n.Button,{as:"a",fontSize:i,href:o+(d||c),icon:u.LaunchIcon,padding:a-1,mode:"bleed",rel:"noreferrer",target:"_blank"})}),value:void 0===d?`${o}${c}`:d})})},Ae=h.motion(n.Flex),Je=y.default(n.Switch)`
  & > span {
    width: 21px;
    height: 13px;
    overflow: hidden;

    & > span:nth-child(1) {
      width: 21px;
      height: 13px;
    }

    & > span:nth-child(2) {
      width: 9px;
      height: 9px;
      top: 2px;
      left: 2px;
    }
  }

  & input:checked + span {
    & > span:nth-child(2) {
      transform: translate3d(8px, 0, 0) !important;
    }
  }
`,Ve={previewDrafts:"Drafts",published:"Published",raw:"Raw"},Ge="caution",Qe="positive",He={previewDrafts:u.EditIcon,published:u.PublishIcon,raw:u.DatabaseIcon},Xe=r.forwardRef((function(t,i){const{initialUrl:s,targetOrigin:o,navigatorEnabled:c,onPathChange:l,overlayEnabled:d,params:f,perspective:m,setPerspective:v,toggleNavigator:g,toggleOverlay:x,loadersConnection:y,overlaysConnection:w,previewKitConnection:b}=t,{devMode:j}=A(),[S,k]=r.useState("desktop"),C=n.usePrefersReducedMotion(),P=r.useCallback((()=>k("desktop")),[k]),E=r.useCallback((()=>k("mobile")),[k]),[I,M]=r.useState(!0),[D,z]=r.useState(!1),[_,T]=r.useState(!1),L=I||_||"connecting"===w,R="unhealthy"===w||"disconnected"===w||"unhealthy"===y||"disconnected"===y||"unhealthy"===b||"disconnected"===b,$=r.useMemo((()=>{const{origin:e}=new URL(f.preview||"/",o);return e===location.origin?"":e}),[f.preview,o]),O=r.useCallback((()=>{"function"!=typeof i&&i?.current&&(i.current.src=`${o}${f.preview||"/"}`,T(!0))}),[f.preview,o,i]),F=r.useCallback((()=>{"function"!=typeof i&&i?.current&&(i.current.src=s.toString(),T(!0))}),[i,s]),[U,q]=r.useState(!1);r.useEffect((()=>{if(!I&&!_&&"connecting"===w){const e=setTimeout((()=>{q(!0)}),3e3);return()=>clearTimeout(e)}}),[w,I,_]),r.useEffect((()=>{if(!I&&!_&&U&&("connected"===w&&z(!1),"connecting"===w)){const e=setTimeout((()=>{z(!0),console.error(`Unable to connect to overlays. Make sure you're calling the 'enableOverlays' function in '@sanity/overlays' correctly, and that its 'allowStudioOrigin' property is set to '${location.origin}'`)}),a.M);return()=>clearTimeout(e)}}),[w,I,_,U]);const N=r.useMemo((()=>{const e=new URL(f.preview||"/",o),{pathname:t,search:n}=p.withoutSecretSearchParams(e);return`${t}${n}`}),[f.preview,o]),B=r.useCallback((()=>{M(!1),T(!1)}),[]);return e.jsx(h.MotionConfig,{transition:C?{duration:0}:void 0,children:e.jsxs(n.TooltipDelayGroupProvider,{delay:1e3,children:[e.jsx(n.Card,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:e.jsxs(n.Flex,{align:"center",gap:2,style:{minHeight:0},children:[g&&e.jsx(n.Tooltip,{content:e.jsx(n.Text,{size:1,children:"Toggle navigator"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Toggle navigator",fontSize:1,icon:u.PanelLeftIcon,mode:"bleed",onClick:g,padding:3,selected:c})}),e.jsx(n.Tooltip,{content:e.jsx(n.Flex,{align:"center",style:{whiteSpace:"nowrap"},children:e.jsx(n.Box,{padding:1,children:e.jsx(n.Text,{size:1,children:d?"Disable edit overlay":"Enable edit overlay"})})}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:e.jsx(n.Card,{as:"label",flex:"none",padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:d?"positive":void 0,children:e.jsxs(n.Flex,{align:"center",gap:2,children:[e.jsx("div",{style:{margin:-2},children:e.jsx(Je,{checked:d,onChange:x,disabled:L})}),e.jsx(n.Box,{children:e.jsx(n.Text,{muted:!0,size:1,weight:"medium",children:"Edit"})})]})})}),j&&e.jsx(n.Tooltip,{content:e.jsx(n.Text,{size:1,children:_?"Refreshing…":"Refresh preview"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Refresh preview",fontSize:1,icon:u.RefreshIcon,mode:"bleed",loading:_,onClick:O,padding:3})}),e.jsx(n.Box,{flex:1,children:e.jsx(Ke,{onChange:l,origin:$,value:N})}),e.jsx(n.Flex,{align:"center",flex:"none",gap:1,children:e.jsx(n.MenuButton,{button:e.jsx(n.Button,{fontSize:1,iconRight:u.ChevronDownIcon,mode:"bleed",padding:3,space:2,text:Ve[m],loading:L||"connecting"===y&&"connected"!==b,disabled:"connected"!==y}),id:"perspective-menu",menu:e.jsxs(n.Menu,{style:{maxWidth:240},children:[e.jsx(n.MenuItem,{fontSize:1,onClick:()=>v("previewDrafts"),padding:3,pressed:"previewDrafts"===m,tone:Ge,children:e.jsxs(n.Flex,{align:"flex-start",gap:3,children:[e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{size:1,children:r.createElement(He.previewDrafts)})}),e.jsxs(n.Stack,{flex:1,space:2,children:[e.jsx(n.Text,{size:1,weight:"medium",children:Ve.previewDrafts}),e.jsx(n.Text,{muted:!0,size:1,children:"View this page with latest draft content"})]}),e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{muted:!0,size:1,style:{opacity:"previewDrafts"===m?1:0},children:e.jsx(u.CheckmarkIcon,{})})})]})}),e.jsx(n.MenuItem,{fontSize:1,onClick:()=>v("published"),padding:3,pressed:"published"===m,tone:Qe,children:e.jsxs(n.Flex,{align:"flex-start",gap:3,children:[e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{size:1,children:r.createElement(He.published)})}),e.jsxs(n.Stack,{flex:1,space:2,children:[e.jsx(n.Text,{size:1,weight:"medium",children:Ve.published}),e.jsx(n.Text,{muted:!0,size:1,children:"View this page with published content"})]}),e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{muted:!0,size:1,style:{opacity:"published"===m?1:0},children:e.jsx(u.CheckmarkIcon,{})})})]})})]}),popover:{constrainSize:!0,placement:"bottom",portal:!0}})}),e.jsxs(n.Flex,{align:"center",flex:"none",gap:1,children:[e.jsx(n.Tooltip,{content:e.jsx(n.Text,{size:1,children:"Full viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Full viewport",fontSize:1,icon:u.DesktopIcon,mode:"bleed",onClick:P,padding:3,selected:"desktop"===S})}),e.jsx(n.Tooltip,{content:e.jsx(n.Text,{size:1,children:"Narrow viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Narrow viewport",fontSize:1,icon:u.MobileDeviceIcon,mode:"bleed",onClick:E,padding:3,selected:"mobile"===S})})]})]})}),e.jsx(n.Card,{flex:1,tone:"transparent",children:e.jsxs(n.Flex,{align:"center",height:"fill",justify:"center",padding:"desktop"===S?0:2,sizing:"border",style:{position:"relative",cursor:L?"wait":void 0},children:[e.jsx(h.AnimatePresence,{children:R||I||_||!U||"connecting"!==y?I||L?e.jsx(Ae,{initial:"initial",animate:"animate",exit:"exit",variants:Ye,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:e.jsxs(n.Flex,{style:{...Ze[S]},justify:"center",align:"center",direction:"column",gap:4,children:[e.jsx(n.Spinner,{muted:!0}),e.jsx(n.Text,{muted:!0,size:1,children:"Loading…"})]})}):R&&!L?e.jsx(Ae,{initial:"initial",animate:"animate",exit:"exit",variants:et,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-shadow-outline-color)"},children:e.jsx(K,{flex:1,message:"Could not connect to the preview",onRetry:F,children:j&&e.jsxs(e.Fragment,{children:[("unhealthy"===w||"disconnected"===w)&&e.jsx(n.Card,{padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Overlay connection status"}),e.jsx(n.Code,{size:1,children:w})]})}),("unhealthy"===y||"disconnected"===y)&&e.jsx(n.Card,{padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Loader connection status"}),e.jsx(n.Code,{size:1,children:y})]})})]})})}):null:e.jsx(Ae,{initial:"initial",animate:"animate",exit:"exit",variants:Ye,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:D?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",zIndex:1},children:e.jsx(n.Flex,{style:{...Ze[S]},justify:"center",align:"center",children:e.jsx(n.Card,{radius:2,tone:D?"caution":"inherit",padding:4,shadow:1,children:e.jsxs(n.Flex,{justify:"center",align:"center",direction:"column",gap:4,children:[e.jsx(n.Spinner,{muted:!0}),e.jsx(n.Text,{muted:!0,size:1,children:D?e.jsx(e.Fragment,{children:"Unable to connect, check the browser console for more information."}):"Connecting…"})]})})})})}),e.jsx(We,{ref:i,style:{pointerEvents:L?"none":"auto",boxShadow:"0 0 0 1px var(--card-shadow-outline-color)",borderTop:"1px solid transparent"},src:s.toString(),initial:["background"],variants:tt,animate:[I||L?"background":"active",_?"reloading":"idle",S,U?"timedOut":""],onLoad:B})]})})]})})})),Ze={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},Ye={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},et={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},tt={desktop:{...Ze.desktop,boxShadow:"0 0 0 0px var(--card-shadow-outline-color)"},mobile:{...Ze.mobile,boxShadow:"0 0 0 1px var(--card-shadow-outline-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};function nt(e){if(void 0===e)return{id:void 0,path:void 0};const n=e?.split(".");return"drafts"===n[0]&&n.shift(),{id:n[0],path:n.length>1?t.studioPath.toString(q(n.slice(1).join("."))):void 0}}function rt(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e&&""!==e&&null!==e)))}function it({initialPreviewUrl:e,routerNavigate:n,routerState:i,routerSearchParams:s}){const[o,a]=r.useState((()=>{const{id:t,path:n}=nt(i.path&&decodeURIComponent(i.path));return{id:t,type:i.type,path:n,preview:s.preview||`${e.pathname}${e.search}`,perspective:s.perspective,inspect:s.inspect,rev:s.rev,since:s.since,template:s.template,view:s.view,pathKey:s.pathKey,instruction:s.instruction,comment:s.comment}})),c=r.useCallback((e=>{a((t=>{const n={...t,...e};return w.default(rt(t),rt(n))?t:n}))}),[]),l=r.useMemo((()=>rt({inspect:o.inspect,path:o.path,rev:o.rev,since:o.since,template:o.template,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment})),[o.inspect,o.path,o.rev,o.since,o.template,o.view,o.pathKey,o.instruction,o.comment]);r.useEffect((()=>{const{type:t}=i,{id:n,path:r}=nt(i.path),o=setTimeout((()=>c({id:n,type:"*"===t?void 0:t,path:r,preview:s.preview||`${e.pathname}${e.search}`,perspective:s.perspective,inspect:s.inspect,rev:s.rev,since:s.since,template:s.template,view:s.view,pathKey:s.pathKey,instruction:s.instruction,comment:s.comment})),0);return()=>clearTimeout(o)}),[e,s,i,c]);const d=r.useMemo((()=>Ce(((e,t)=>{const r=rt(e);n(r,t)}),50)),[n]),u=r.useRef(o.preview);return r.useEffect((()=>{const e=u.current;u.current=o.preview;const n=o.type,r=o.id?function(e){let t="";for(const n of e)"string"!=typeof n?"number"!=typeof n?$(n)?(t&&(t+=":"),t+=`${n.join(",")}}`):n._key&&(t&&(t+=":"),t+=`${n._key}`):(t&&(t+=":"),t+=`${n}`):(t&&(t+="."),t+=n);return t}(t.studioPath.fromString([o.id,o.path].filter(Boolean).join("."))):void 0,i=rt({preview:o.preview,perspective:"published"===o.perspective?"published":void 0,inspect:o.inspect,rev:o.rev,since:o.since,template:o.template,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment}),s=o.preview===e,a=setTimeout((()=>d({type:n,path:r,_searchParams:Object.entries(i)},{replace:s})),0);return()=>clearTimeout(a)}),[d,o]),{navigate:d,setParams:c,deskParams:l,params:o}}function st(e,t,n){const s=i.useClient({apiVersion:"2023-10-16"}),[o]=r.useState((()=>e)),a=i.useCurrentUser(),c=r.useMemo((()=>"object"==typeof o?v.definePreviewUrl(o):o),[o]),[l]=r.useState((()=>"string"==typeof c&&n?new URL(n,new URL(c,location.origin)):null)),d=function(e,t){const n=i.useActiveWorkspace(),r=n?.activeWorkspace?.basePath;return["@sanity/presentation",r,n?.activeWorkspace?.name||"default",e,t,ot]}(t,a?.id),u="function"==typeof c?g.suspend((async()=>{const{secret:e}=await m.createPreviewSecret(s,"@sanity/presentation","undefined"==typeof window?"":location.href,a?.id);return c({client:s,previewUrlSecret:e,previewSearchParam:n})}),d):l||c;return r.useMemo((()=>new URL(u,location.origin)),[u])}const ot=Symbol();function at(t){const{minWidth:n,maxWidth:r,component:i}=t,s=null!=n&&null!=r&&n===r;return e.jsxs(e.Fragment,{children:[e.jsx(be,{id:"navigator",minWidth:n,maxWidth:r,order:1,children:e.jsx(i,{})}),e.jsx(ke,{order:2,disabled:s})]})}const ct=y.default(n.Flex)`
  overflow-x: auto;
`;exports.default=function(o){const{previewUrl:c,components:l}=o.tool.options??{},d=o.tool.name||a.D,{unstable_navigator:u}=l||{},{navigate:p,state:h}=s.useRouter(),f=i.useUnique(Object.fromEntries(h._searchParams||[])),m=st(c||"/",d,f.preview||null),[v]=r.useState((()=>{const e=o.tool.options?.devMode;return"function"==typeof e?e():"boolean"==typeof e?e:"undefined"!=typeof window&&"localhost"===window.location.hostname})),g=r.useMemo((()=>m.origin),[m.origin]),x=r.useRef(null),[y,w]=r.useState(),[b,j]=r.useState({}),{setParams:S,params:k,deskParams:C}=it({initialPreviewUrl:m,routerNavigate:p,routerState:h,routerSearchParams:f}),[P,E]=r.useState((()=>"published"===k.perspective?k.perspective:"previewDrafts")),[I,M]=function(e){const[t,n]=r.useState((()=>({published:new Map,previewDrafts:new Map,raw:new Map}))),i=r.useCallback(((e,t)=>{n((n=>{let r=!1,i=n[e];const s=e=>`${e._projectId}-${e.dataset}-${e._type}-${e._id}`,o=new Set;for(const e of t){const t=s(e);o.add(t),i.has(t)||(i.set(t,e),r=!0)}for(const e of i.keys())o.has(e)||(i.delete(e),r=!0);return r?(i=new Map(i),{...n,[e]:new Map(i)}):n}))}),[]),s=r.useMemo((()=>t[e]),[e,t]);return[r.useMemo((()=>[...s.values()]),[s]),i]}(P),[D,z]=r.useState(!0),_=!!u?.component,[T,L]=function(e,t){const[n,i]=r.useState((()=>JSON.parse(localStorage.getItem(e)??JSON.stringify(t))));return r.useEffect((()=>{localStorage.setItem(e,JSON.stringify(n))}),[e,n]),[n,i]}("presentation/navigator",_),$=i.useProjectId(),O=i.useDataset(),F=r.useRef(),U=r.useRef(k.id),q=r.useMemo((()=>{if(_)return()=>L((e=>!e))}),[_,L]),[N,K]=r.useState((()=>I.slice(0,3).map((e=>({...e,_id:i.getPublishedId(e._id)})))));r.useEffect((()=>{P!==k.perspective&&S({perspective:P})}),[k.perspective,P,S]),r.useEffect((()=>{K(I.slice(0,3).map((e=>({...e,_id:i.getPublishedId(e._id)}))))}),[I]),r.useEffect((()=>{k.id!==U.current&&(U.current=k.id,k.id&&K((e=>e.find((e=>e._id===k.id))?e:e.slice(1).concat([{_id:k.id,_type:k.type}]))))}),[k]);const[A,J]=r.useState("fresh"),[V,G]=r.useState("fresh"),[Q,H]=r.useState("fresh");r.useEffect((()=>{const e=x.current?.contentWindow;if(!e)return;const t=R({id:"presentation",onStatusUpdate(e,t,n){"loaders"===n.config.id&&G(e),"overlays"===n.config.id&&J(e),"preview-kit"===n.config.id&&H(e)},connections:[{target:e,targetOrigin:g,id:"overlays",heartbeat:!0},{target:e,targetOrigin:g,id:"loaders",heartbeat:!0},{target:e,targetOrigin:g,id:"preview-kit",heartbeat:!0}],handler(e,t){if("overlay/focus"===e&&"id"in t)S({id:t.id,path:t.path,type:t.type});else if("overlay/navigate"===e){if(F.current!==t.url){const e=void 0===F.current;F.current=t.url,S(e?{preview:t.url}:{id:void 0,type:void 0,preview:t.url})}}else"overlay/toggle"===e?z(t.enabled):"loader/documents"===e||"preview-kit/documents"===e&&t.projectId===$&&t.dataset===O?M(t.perspective,t.documents):"loader/query-listen"===e&&t.projectId===$&&t.dataset===O&&j((e=>{return{...e,[(n=t.query,r=t.params,`${n}-${"string"==typeof r?r:JSON.stringify(r)}`)]:{perspective:t.perspective,query:t.query,params:t.params}};var n,r}))}});return w(t),()=>{t.disconnect(),w(void 0)}}),[O,$,M,S,g]);const X=r.useCallback(((e,n)=>{S({path:t.studioPath.toString(n)})}),[S]),Z=r.useCallback((e=>{const t=new URL(e,m.origin),n=t.pathname+t.search;t.origin===m.origin&&n!==k.preview&&S({id:void 0,path:void 0,preview:n})}),[m,k,S]),Y=r.useCallback((e=>{S({...e})}),[S]);r.useEffect((()=>{k.id&&k.path?y?.send("presentation/focus",{id:k.id,path:k.path}):y?.send("presentation/blur",void 0)}),[y,k.id,k.path]),r.useEffect((()=>{F.current&&k.preview&&F.current!==k.preview&&(F.current=k.preview,y?.send("presentation/navigate",{url:k.preview,type:"push"}))}),[y,k.preview]);const ee=r.useCallback((()=>y?.send("presentation/toggleOverlay",void 0)),[y]),[te,ne]=r.useState(null),re=r.useCallback((e=>ne(e)),[]);return r.useEffect((()=>{const e=e=>{W(e)&&ee()},t=e=>{W(e)&&ee(),B(["mod","\\"],e)&&ee()};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}}),[ee]),e.jsxs(e.Fragment,{children:[e.jsxs(Be,{deskParams:C,devMode:v,name:d,params:k,setParams:S,children:[N.map((t=>e.jsx(Ue,{id:t._id,type:t._type},t._id))),e.jsx(qe,{setParams:S,children:e.jsx(Ne,{params:k,children:e.jsx(ct,{height:"fill",children:e.jsxs(Fe,{children:[_&&T&&e.jsx(at,{...u}),e.jsx(be,{id:"preview",minWidth:325,defaultSize:T?50:75,order:3,children:e.jsx(n.Flex,{direction:"column",flex:1,height:"fill",children:e.jsx(Xe,{initialUrl:m,navigatorEnabled:T,onPathChange:Z,overlayEnabled:D,params:k,perspective:P,ref:x,setPerspective:E,targetOrigin:g,toggleNavigator:q,toggleOverlay:ee,loadersConnection:V,overlaysConnection:A,previewKitConnection:Q})})}),e.jsx(ke,{order:4}),e.jsx(be,{id:"content",minWidth:325,order:5,children:e.jsx(ie,{refs:I,deskParams:C,documentId:k.id,documentType:k.type,onDeskParams:Y,onFocusPath:X,onDocumentChange:re,previewUrl:k.preview})})]})})})})]}),y&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{activePerspective:"published"===P,channel:y,liveQueries:b,perspective:"published",liveDocument:te?._id?.startsWith("drafts.")?null:te},"published"),e.jsx(ge,{activePerspective:"previewDrafts"===P,channel:y,liveQueries:b,perspective:"previewDrafts",liveDocument:te},"previewDrafts")]})]})};//# sourceMappingURL=PresentationTool-89YWZAjN.cjs.map
