import{jsx as e,jsxs as t,Fragment as n}from"react/jsx-runtime";import{applySourceDocuments as r,studioPath as i}from"@sanity/client/csm";import{Card as o,Flex as a,Container as s,Stack as c,Text as d,Box as l,Button as u,Code as p,Label as h,ErrorBoundary as f,TextInput as m,Switch as v,usePrefersReducedMotion as g,TooltipDelayGroupProvider as w,Tooltip as y,MenuButton as b,Menu as k,MenuItem as P,Spinner as x}from"@sanity/ui";import{useContext as S,forwardRef as I,useCallback as z,useMemo as D,useState as E,useEffect as C,createContext as j,memo as $,useSyncExternalStore as O,useLayoutEffect as M,useRef as _,createElement as L}from"react";import{useUnique as R,getPublishedId as U,useEditState as T,useClient as N,useCurrentUser as W,useActiveWorkspace as A,useProjectId as K,useDataset as F}from"sanity";import{StateLink as J,useRouter as q}from"sanity/router";import B from"styled-components";import{P as V,a as G,b as Q,M as H,D as X}from"./index-DGcVCSsW.js";import{PaneRouterContext as Z,PaneLayout as Y,DeskToolProvider as ee,DocumentListPane as te,useDeskTool as ne,DocumentPane as re}from"sanity/desk";import{unstable__getDocumentCacheKey as ie,unstable__documentsCache as oe}from"@sanity/groq-store";import{applyPatch as ae}from"mendoza";import{ResetIcon as se,LaunchIcon as ce,PanelLeftIcon as de,RefreshIcon as le,ChevronDownIcon as ue,CheckmarkIcon as pe,DesktopIcon as he,MobileDeviceIcon as fe,EditIcon as me,PublishIcon as ve,DatabaseIcon as ge}from"@sanity/icons";import{withoutSecretSearchParams as we}from"@sanity/preview-url-secret/without-secret-search-params";import{motion as ye,MotionConfig as be,AnimatePresence as ke}from"framer-motion";import Pe from"lodash.isequal";import{createPreviewSecret as xe}from"@sanity/preview-url-secret/create-secret";import{definePreviewUrl as Se}from"@sanity/preview-url-secret/define-preview-url";import{suspend as Ie}from"suspend-react";let ze;const De=new Uint8Array(16);function Ee(){if(!ze&&(ze="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ze))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ze(De)}const Ce=[];for(let e=0;e<256;++e)Ce.push((e+256).toString(16).slice(1));var je={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function $e(e,t,n){if(je.randomUUID&&!t&&!e)return je.randomUUID();const r=(e=e||{}).random||(e.rng||Ee)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return Ce[e[t+0]]+Ce[e[t+1]]+Ce[e[t+2]]+Ce[e[t+3]]+"-"+Ce[e[t+4]]+Ce[e[t+5]]+"-"+Ce[e[t+6]]+Ce[e[t+7]]+"-"+Ce[e[t+8]]+Ce[e[t+9]]+"-"+Ce[e[t+10]]+Ce[e[t+11]]+Ce[e[t+12]]+Ce[e[t+13]]+Ce[e[t+14]]+Ce[e[t+15]]}(r)}const Oe=1e3,Me=3e3,_e=["channel/disconnect","channel/response"],Le=["handshake/syn","handshake/syn-ack","handshake/ack"],Re=e=>Boolean(e)&&"object"==typeof e&&!Array.isArray(e),Ue=e=>_e.some((t=>t===e)),Te=e=>Le.some((t=>t===e)),Ne=e=>"channel/heartbeat"===e;function We(e){const t=window.self!==window.top,n=e.connections.map((e=>({buffer:[],config:e,heartbeat:null,id:null,status:"fresh"})));function r(e){e.heartbeat&&window.clearInterval(e.heartbeat)}function i(t,n){const i=t.status;i!==n&&(t.status=n,e.onStatusUpdate?.(n,i,t),"connected"===n&&(function(e){const t=[...e.buffer];e.buffer.splice(0,e.buffer.length),t.forEach((({type:t,data:n})=>{o(e,t,n)}))}(t),function(e){if(r(e),e.config.heartbeat){const t="number"==typeof e.config.heartbeat?e.config.heartbeat:Me;e.heartbeat=window.setInterval((()=>{c("channel/heartbeat",void 0,[e])}),t)}}(t)),"disconnected"===n&&r(t))}function o(t,r,i){return new Promise(((o,a)=>{const s={id:$e(),type:r,connectionId:t.id,from:e.id,to:t.config.id,data:i},c=Ue(r),d=Te(r),l=Ne(r),u=n.find((e=>e.id===t.id&&"connected"===e.status));if(c||d||l||u){if(!c||l){const n=setTimeout((()=>{s.connectionId===t.id?a({reason:`Received no response to message '${s.id}' on client '${e.id}'`,msg:s,connection:t}):o(s.id)}),Oe),r=e=>{const{data:t}=e;"channel/response"===t.type&&t.data?.responseTo&&t.data.responseTo===s.id&&(window.removeEventListener("message",r,!1),clearTimeout(n),o(s.id))};window.addEventListener("message",r,!1)}try{const e=d?"*":t.config.targetOrigin;return t.config.target.postMessage(s,{targetOrigin:e}),void((c||d)&&o(s.id))}catch(n){console.error("Failed to postMessage",n,{msg:s,connection:t}),a({reason:`Failed to postMessage '${s.id}' on client '${e.id}'`,msg:s,connection:t})}}"fresh"!==t.status&&"connecting"!==t.status||(t.buffer.push({type:r,data:i}),o(s.id)),a({reason:`Will not send message '${s.id}' on client '${e.id}'`,msg:s,connection:t})}))}function a(e,t,n){return Promise.allSettled(e.map((e=>o(e,t,n))))}function s(t){const r=function(t){const{source:r,origin:i,data:o}=t;if(Re(o))return n.find((t=>e.id===o.to&&t.config.id===o.from&&t.config.target===r&&(t.config.targetOrigin===i||"*"===t.config.targetOrigin)&&(t.id===o.connectionId||Te(o.type))))}(t);if(!r)return;const{data:a}=t;if(Te(a.type))!function(e,t){if("handshake/syn"===t.data.type){const n=t.data.data?.id||e.id;e.id=n,o(e,"handshake/syn-ack",{id:n})}if("handshake/syn-ack"===t.data.type){const n=t.data.data?.id||e.id;e.id=n,i(e,"connected"),o(e,"handshake/ack",{id:n})}if("handshake/ack"===t.data.type){const n=t.data.data?.id||e.id;e.id=n,i(e,"connected")}}(r,t);else if("channel/disconnect"===a.type)i(r,"disconnected");else if("channel/response"===a.type);else{const t=[a.type,a.data];e.handler(...t),o(r,"channel/response",{responseTo:a.id})}}async function c(e,t,r){const o=await a(r||n,e,t);return o.forEach((e=>{if("rejected"===e.status){const t=n.find((t=>"connected"===t.status&&t.id===e.reason.connection.id));t&&i(t,"unhealthy")}})),o}return function(){window.addEventListener("message",s,!1);const e=n.filter((e=>["disconnected","fresh","unhealthy"].includes(e.status)));Promise.all(e.map((e=>(i(e,"connecting"),o(e,"handshake/syn",{id:$e()})))))}(),{disconnect:function(){window.removeEventListener("message",s,!1);const e=n.filter((({status:e})=>"connecting"===e||"connected"===e));e.length&&(a(e,"channel/disconnect"),e.forEach((e=>{i(e,"disconnected")})))},inFrame:t,send:c}}function Ae(e){return null!==e&&Array.isArray(e)}const Ke=/^([A-Za-z]+):([0-9]+)$/,Fe=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,Je=/^([A-Za-z]+):([a-z0-9]+)$/;function qe(e){const t=[];for(const n of e.split(".")){const e=Ke.exec(n);if(e){t.push(e[1],Number(e[2]));continue}const r=Fe.exec(n);if(r){t.push(r[1],[Number(r[2]),Number(r[3])]);continue}const i=Je.exec(n);i?t.push(i[1],{_key:i[2]}):t.push(n)}return t}const Be={alt:"altKey",ctrl:"ctrlKey",mod:"undefined"!=typeof window&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function Ve(e,t){return e.every((e=>Be[e]?t[Be[e]]:t.key===e.toUpperCase()))}function Ge(e){return"Alt"===e.key}function Qe(n){const{children:r,message:i,onRetry:p,...h}=n;return e(o,{height:"fill",...h,children:e(a,{align:"center",height:"fill",justify:"center",children:e(s,{padding:4,sizing:"border",width:0,children:t(c,{space:4,children:[t(c,{space:3,children:[e(d,{size:1,weight:"semibold",children:"An error occured"}),e(d,{muted:!0,size:1,children:i})]}),r,p&&e(l,{children:e(u,{fontSize:1,mode:"ghost",onClick:p,text:"Retry"})})]})})})})}function He(){const e=S(V);if(!e)throw new Error("Presentation context is missing");return e}function Xe(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(e={}){const t=Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&");return t.length?`?${t}`:""}(Object.entries(e).filter((([e])=>t.includes(e))).reduce(((e,[t,n])=>null==n?e:{...e,[t]:n}),{}))}const Ze=I((function(t,n){const{deskParams:r,params:i}=He();return e(J,{...t,ref:n,state:{type:void 0,_searchParams:Object.entries({...r,preview:i.preview})},title:void 0})})),Ye=I((function(t,n){const{documentId:r,documentType:i,...o}=t;return e(J,{...o,ref:n,state:{path:r,type:i},title:void 0})}));function et(t){const{children:r,params:i,onDeskParams:o,previewUrl:a,refs:s}=t,{state:c,resolvePathFromState:d}=q(),l=R(Object.fromEntries(c._searchParams||[])),u=z((e=>`${d(c)}${Xe({...l,...e})}`),[d,l,c]),p=D((()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:i,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:t=>{const{childId:n,...r}=t,i=s?.find((e=>U(e._id)===n));return i?e(J,{...r,state:{path:i._id,type:i._type,_searchParams:Object.entries({preview:a})}}):e("div",{...r})},BackLink:Ze,ReferenceChildLink:Ye,ParameterizedLink:()=>e(n,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:e=>{console.warn("handleEditReference",e)},replaceCurrent:e=>{console.warn("replaceCurrent",e)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:e=>{console.warn("duplicateCurrent",e)},setView:e=>{console.warn("setView",e)},setParams:e=>{o({...e,inspect:e.inspect??void 0})},setPayload:e=>{console.warn("setPayload",e)},navigateIntent:(e,t,n)=>{console.warn("navigateIntent",e,t,n)},createPathWithParams:u})),[u,o,i,a,s]);return e(Z.Provider,{value:p,children:r})}const tt=B(Y)`
  height: 100%;
`,nt=B(a)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,rt=B(p)`
  white-space: pre-wrap;
`;function it(n){const{onDeskParams:r,previewUrl:i,refs:a}=n,{devMode:s}=He(),d=D((()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:a.map((e=>e._id))}},schemaTypeName:"",title:"Documents on this page",type:"documentList"})),[a]),[l,u]=E(null),p=z((()=>u(null)),[]),m=D((()=>({})),[]);return C((()=>u(null)),[a]),l?e(Qe,{flex:1,message:"Could not render the document list",onRetry:p,children:s&&e(o,{overflow:"auto",padding:3,radius:2,tone:"critical",children:t(c,{space:3,children:[e(h,{muted:!0,size:0,children:"Error message"}),e(rt,{size:1,children:l.error.message})]})})}):e(f,{onCatch:u,children:e(tt,{children:e(ee,{children:e(et,{params:m,onDeskParams:r,previewUrl:i,refs:a,children:e(nt,{direction:"column",flex:1,children:e(te,{index:0,itemId:"$root",pane:d,paneKey:"$root"})})})})})})}function ot(t){const{onDeskParams:n,previewUrl:r,refs:i}=t;return e(it,{onDeskParams:n,previewUrl:r,refs:i})}const at=B(p)`
  white-space: pre-wrap;
`;function st(n){const{documentId:r,documentType:i,params:a,onDeskParams:s,onFocusPath:d}=n,{devMode:l}=He(),u=D((()=>({id:r,options:{id:r,type:i},title:"",type:"document"})),[r,i]),[p,m]=E(null),v=z((()=>m(null)),[]);C((()=>{m(null)}),[r,i,a]);const{setLayoutCollapsed:g}=ne(),w=z((()=>g(!0)),[g]),y=z((()=>g(!1)),[g]);return p?e(Qe,{flex:1,message:"Could not render the document editor",onRetry:v,children:l&&e(o,{overflow:"auto",padding:3,radius:2,tone:"critical",children:t(c,{space:3,children:[e(h,{muted:!0,size:0,children:"Error message"}),e(at,{size:1,children:p.error.message})]})})}):e(f,{onCatch:m,children:e(Y,{style:{height:"100%"},onExpand:y,onCollapse:w,children:e(et,{onDeskParams:s,params:a,children:e(re,{paneKey:"document",index:1,itemId:"document",pane:u,onFocusPath:d})})})})}function ct(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a,onDocumentChange:s}=t,c=T(r,i),d=c.draft||c.published;C((()=>s(d)),[d,s]);const l=z((e=>{d?._id&&a(d._id,e)}),[d,a]);return e(ee,{children:e(st,{documentId:r,documentType:i,params:n,onDeskParams:o,onFocusPath:l})})}function dt(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a,onDocumentChange:s,previewUrl:c,refs:d}=t;return r&&i?e(ct,{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a,onDocumentChange:s}):e(ot,{onDeskParams:o,previewUrl:c,refs:d})}const lt=j(null);j(null);const ut=j(!1);let pt=!1;function ht(e,t,n,i,o,a){if("raw"===o)throw new Error("turboChargeResultIfSourceMap does not support raw perspective");return r(i,a,(r=>{if(r._projectId)return void(pt||(console.warn("Cross dataset references are not supported yet, ignoring source document",r),pt=!0));if(e?._id===r._id&&e?._type===r._type)return e;const i=ie({projectId:t,dataset:n,perspective:o},r);return oe.get(i)}))}function ft(e,t,n){return`${e}-${t}-${JSON.stringify(n)}`}const mt=$((function(n){const{liveDocument:r,children:i,client:o,refreshInterval:a=2e3,perspective:s}=n;if("raw"===s)throw new Error("LiveStoreProvider does not support the raw perspective");const[c,d]=E([]),[l]=E((()=>new Map)),u=function(e){const[t]=E((()=>new Map)),n=z(((n,r,i,o,a)=>{t.has(n)||(t.set(n,{perspective:r,query:i,params:o,listeners:new Set}),e((e=>e.includes(n)?e:[...e,n])));const s=t.get(n);if(!s||!s.listeners)throw new TypeError("Inconsistent cache for key: "+n);const{listeners:c}=s;return c.add(a),()=>{c.delete(a),0===c.size&&(t.delete(n),e((e=>e.includes(n)?e.filter((e=>e!==n)):e)))}}),[t,e]);return D((()=>({cache:t,subscribe:n})),[t,n])}(d),[p]=E((()=>function(e,t,n){const r=ft(s,t,n);return{subscribe:e=>{const i=u.subscribe(r,s,t,n,e);return()=>i()},getSnapshot:()=>l.get(r)}})),[h,f]=E([]),m=z((e=>{const t=new Set;if(e.documents?.length)for(const{_id:n}of e.documents)t.add(n);f((e=>{const n=Array.from(new Set([...e,...t]));return JSON.stringify(n.sort())===JSON.stringify(e.sort())?e:n}))}),[]);return t(lt.Provider,{value:p,children:[e(ut.Provider,{value:!0,children:i}),e(yt,{liveDocument:r,cache:u.cache,client:o,setTurboIds:f,snapshots:l,turboIds:h,perspective:s}),c.map((t=>{if(!u.cache.has(t))return null;const{query:n,params:i,listeners:c}=u.cache.get(t);return e(gt,{liveDocument:r,client:o,listeners:c,params:i,query:n,refreshInterval:a,snapshots:l,turboIdsFromSourceMap:m,perspective:s},t)}))]})}));mt.displayName="LiveStoreProvider";var vt=mt;const gt=$((function(e){const{liveDocument:t,client:n,refreshInterval:r,query:i,params:o,listeners:a,snapshots:s,turboIdsFromSourceMap:c,perspective:d}=e,{projectId:l,dataset:u}=D((()=>{const{projectId:e,dataset:t}=n.config();return{projectId:e,dataset:t}}),[n]),[p,h]=E(null);if(p)throw p;const[f,m]=function(e){const{refreshInterval:t}=e,n=function(){const[e,t]=E(!1);C((()=>{t(navigator.onLine);const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e),window.addEventListener("offline",n),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}),[]);const n=O(wt,(()=>document.visibilityState),(()=>"hidden"));if(!e)return!0;if("hidden"===n)return!0;return!1}(),[r,i]=E("hit"),o=z((()=>(i("inflight"),()=>i("hit"))),[]);return C((()=>{if(!t||"hit"!==r)return;const e=setTimeout((()=>i("stale")),t);return()=>clearTimeout(e)}),[t,r]),C((()=>{if("hit"!==r)return;const e=()=>i("stale");return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)}),[t,r]),C((()=>{n&&"hit"===r&&i("stale"),n||"stale"!==r||i("refresh")}),[n,r]),[r,o]}({refreshInterval:r}),v="refresh"===f||"inflight"===f;return C((()=>{if(!v)return;let e=!1;const r=new AbortController;const p=m();return async function(){const{signal:p}=r,{result:h,resultSourceMap:f}=await n.fetch(i,o,{tag:"presentation-loader",signal:p,perspective:d,filterResponse:!1});if(!p.aborted){s.set(ft(d,i,o),{result:f?ht(t,l,u,h,d,f):h,resultSourceMap:f}),f&&c(f);for(const e of a.values())e();e=!0}}().catch((e=>{"AbortError"!==e.name&&h(e)})).finally(p),()=>{e||r.abort()}}),[t,n,u,a,o,l,i,v,s,m,c,d]),null}));function wt(e){return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)}gt.displayName="QuerySubscription";const yt=$((function(t){const{liveDocument:r,client:i,snapshots:o,cache:a,turboIds:s,setTurboIds:c,perspective:d}=t,{projectId:l,dataset:u}=D((()=>{const{projectId:e,dataset:t}=i.config();return{projectId:e,dataset:t}}),[i]);C((()=>{const e=new Set;for(const{perspective:t,query:n,params:r}of a.values()){const i=ft(t,n,r),a=o.get(i);if(a&&a.resultSourceMap?.documents?.length)for(const{_id:t}of a.resultSourceMap.documents)e.add(t)}const t=[...e].sort();JSON.stringify(s)!==JSON.stringify(t)&&c(t)}),[a,c,o,s]);const[p,h]=E([]);C((()=>{const e=new Set(p.flat()),t=new Set;for(const n of s)e.has(n)||oe.has(ie({projectId:l,dataset:u,perspective:d},{_id:n}))||t.add(n);const n=[...t].slice(0,10);0!==n.length&&h((e=>[...e.slice(-10),n]))}),[p,u,d,l,s]);const[f,m]=E();C((()=>{const e=i.listen("published"===d?'*[!(_id in path("drafts.**"))]':'*[_id in path("drafts.**")]',{},{events:["mutation"],effectFormat:"mendoza",includePreviousRevision:!1,includeResult:!1,tag:"presentation-loader"}).subscribe((e=>{if("mutation"!==e.type||!e.effects?.apply?.length)return;const t=ie({projectId:l,dataset:u,perspective:d},{_id:e.documentId}),n=oe.peek(t);if(n){const r={...n};delete r._rev;const i=ae(r,e.effects.apply);oe.set(t,i)}m(e.documentId)}));return()=>e.unsubscribe()}),[i,u,d,l]),C((()=>{if(!f||!s.includes(f))return;const e=[];for(const[t,n]of o.entries())n.resultSourceMap?.documents?.length&&(n.result=ht(r,l,u,n.result,d,n.resultSourceMap),e.push(t));for(const t of e){const e=a.get(t)?.listeners;if(e)for(const t of e)t()}m(void 0)}),[r,a,u,f,d,l,o,s]);const[v,g]=E();return C((()=>{if(!v)return;const e=[];for(const[t,n]of o.entries())n.resultSourceMap?.documents?.length&&(n.result=ht(r,l,u,n.result,d,n.resultSourceMap),e.push(t));for(const t of e){const e=a.get(t)?.listeners;if(e)for(const t of e)t()}}),[a,u,r,v,d,l,o]),C((()=>{r&&g(r._rev)}),[r]),e(n,{children:p.map((t=>e(bt,{client:i,projectId:l,dataset:u,ids:t,perspective:d},JSON.stringify(t))))})}));yt.displayName="Turbo";const bt=$((function(e){const{client:t,projectId:n,dataset:r,ids:i,perspective:o}=e;return C((()=>{const e=i.filter((e=>!oe.has(ie({projectId:n,dataset:r,perspective:o},{_id:e}))));0!==e.length&&t.getDocuments(e).then((e=>{for(const t of e)t&&t?._id&&oe.set(ie({projectId:n,dataset:r,perspective:o},t),t)}),console.error)}),[t,r,i,o,n]),null}));function kt(e,t,n){const r=S(lt);if(!r)throw new Error("useLiveQuery must be used inside a <LiveQueryProvider />");const i=function(e){const t=D((()=>JSON.stringify(e||{})),[e]);return D((()=>JSON.parse(t)),[t])}(n),o=D((()=>r(e,t,i)),[r,e,i,t]),[a]=E((()=>{if(void 0===e)throw new Error("initialSnapshot can't be undefined, if you don't want an initial value use null instead");try{return JSON.parse(JSON.stringify(e))}catch(t){return console.warn("Failed to deep clone initialSnapshot, this is likely an error and an indication that the snapshot isn't JSON serializable",{initialSnapshot:e,error:t}),e}})),s=z((()=>a),[a]);return O(o.subscribe,o.getSnapshot,s)}function Pt(t){const{activePerspective:n,liveDocument:r,channel:i,perspective:o,liveQueries:a}=t,s=N({apiVersion:"2023-10-16"}),c=D((()=>s.config()),[s]),d=D((()=>s.withConfig({perspective:o,resultSourceMap:"withKeyArraySelector"})),[o,s]);return C((()=>{if(i&&n){const{projectId:e,dataset:t}=c;i.send("loader/perspective",{projectId:e,dataset:t,perspective:o})}}),[n,i,c,o]),e(vt,{liveDocument:r,client:d,perspective:o,refreshInterval:n?2e3:0,children:Object.entries(a).map((([t,{query:n,params:r}])=>e(xt,{projectId:c.projectId,dataset:c.dataset,perspective:o,query:n,params:r,channel:i},`${t}${o}`)))})}function xt(e){const{projectId:t,dataset:n,perspective:r,query:i,params:o,channel:a}=e,s=kt(null,i,o),c=s?.result,d=s?.resultSourceMap;return C((()=>{d&&a.send("loader/query-change",{projectId:t,dataset:n,perspective:r,query:i,params:o,result:c,resultSourceMap:d})}),[a,n,o,r,t,i,c,d]),null}bt.displayName="GetDocuments";const St=j(null);St.displayName="PanelsContext";const It=B.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,zt=function({children:t,defaultSize:n=null,id:r,minWidth:i,maxWidth:o,order:a=0}){const s=S(St);if(null===s)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:c,registerElement:d,unregisterElement:l}=s,u=c(r);return M((()=>(d(r,{id:r,type:"panel",defaultSize:n,maxWidth:o??null,minWidth:i??0,order:a}),()=>{l(r)})),[r,n,a,o,i,d,l]),e(It,{style:u,children:t})};const Dt=B.div`
  position: relative;
`,Et=B.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:e})=>e?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-shadow-outline-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:e})=>!e&&"\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  "}
`,Ct=function({id:n,order:r,disabled:i=!1}){const o=_(null),a=S(St);if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const s=function(e){return _(e||$e()).current}(n),{activeResizer:c,drag:d,startDragging:l,stopDragging:u,registerElement:p,unregisterElement:h}=a,f=c===s;if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const m=z((e=>{l(s,e.nativeEvent)}),[s,l]),v=z((e=>{d(s,e)}),[s,d]),g=z((()=>{o.current.blur(),u()}),[u]);return C((()=>{if(f&&!i)return window.addEventListener("mousemove",v),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",g)}}),[i,f,v,g]),M((()=>(p(s,{id:s,order:r,type:"resizer",el:o}),()=>{h(s)})),[s,r,p,h]),e(Dt,{onMouseDown:m,ref:o,children:t(Et,{$disabled:i,children:[e("span",{}),e("span",{})]})})};function jt(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(e,r)}),t)}}const $t="presentation/panels",Ot=()=>JSON.parse(localStorage.getItem($t)||"{}"),Mt=e=>e.map((e=>[e.id,e.order].join(":"))).join(",");function _t(){return D((()=>{const e=(e,t)=>{(e=>{localStorage.setItem($t,JSON.stringify(e))})({...Ot(),[Mt(e)]:t})};return{get:e=>Ot()[Mt(e)],set:e,setDebounced:jt(e,100)}}),[])}function Lt(e,t,n){const{maxWidth:r,minWidth:i}=e,o=null==r?100:r/n*100,a=i/n*100;return Math.min(o,Math.max(a,t))}function Rt(e,t,n){if(1===e.length)return"100";const r=n[e.findIndex((e=>e.id===t))];return null==r?"0":r.toPrecision(10)}function Ut(e,t,n=0,r=null){return e.clientX-(r||t.getBoundingClientRect()).left-n}function Tt(e){return"panel"===e.type}function Nt(e){return"resizer"===e.type}function Wt(e){return Array.from(e.values()).sort((({order:e},{order:t})=>null==e&&null==t?0:null==e?-1:null==t?1:e-t))}function At(e,t,n){const r=t.reduce(((e,t)=>e+t),0),i=[...t].map((e=>e/r*100));let o=0;for(let t=0;t<e.length;t++){const r=e[t],a=i[t],s=Lt(r,a,n);a!=s&&(o+=a-s,i[t]=s)}if("0.000"!==o.toFixed(3))for(let t=0;t<e.length;t++){const r=e[t];let{maxWidth:a,minWidth:s}=r;s=s/n*100,null!=a&&(a=a/n*100);const c=Math.min(null!=a?a:100,Math.max(s,i[t]+o));if(c!==i[t]&&(o-=c-i[t],i[t]=c,"0.000"===Math.abs(o).toFixed(3)))break}return i}const Kt=B.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,Ft=function({children:t}){const n=_(null),[r,i]=E(new Map),o=D((()=>Wt(r).filter(Tt)),[r]),[a,s]=E([]),[c,d]=E(null),l=_({elements:r,panels:o,widths:a}),u=z((e=>({flexGrow:Rt(o,e,a),pointerEvents:null===c?void 0:"none"})),[c,o,a]),p=z(((e,t)=>{i((n=>{if(n.has(e))return n;const r=new Map(n);return r.set(e,t),r}))}),[]),h=z((e=>{i((t=>{if(!t.has(e))return t;const n=new Map(t);return n.delete(e),n}))}),[]),f=_({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),m=z(((e,t)=>{const n=Wt(r),i=n.findIndex((t=>t.id===e)),o=r.get(e);if(!o||!Nt(o))return;const a=o.el.current;a&&(f.current={resizerIndex:i,panelBefore:n.reduce(((e,t,n)=>Tt(t)&&n<i?t:e),null),panelAfter:n.reduce(((e,t,n)=>null===e&&Tt(t)&&n>i?t:e),null),containerWidth:window.innerWidth,startX:t.pageX,dragOffset:Ut(t,a),resizerRect:a.getBoundingClientRect(),widths:l.current.widths},d(e))}),[r]),v=z((()=>{d(null)}),[]),g=z(((e,t)=>{t.preventDefault(),t.stopPropagation();const{containerWidth:i,dragOffset:o,panelBefore:a,panelAfter:c,resizerRect:d}=f.current;if(null==a||null==c)return;const u=r.get(e);if(!u||!Nt(u))return;const p=u.el.current;if(!p)return;const h=Ut(t,p,o,d);if(0===h)return;const{widths:m}=l.current,v=function(e,t,n,r,i,o){const{panels:a,widths:s}=i,{widths:c}=o,d=c||s,l=[...d];{const i=e<0?r:n,o=d[a.findIndex((e=>e.id===i.id))],s=Lt(i,o+Math.abs(e),t);if(o===s)return d;e=e<0?o-s:s-o}let u=0,p=e<0?n:r,h=a.findIndex((e=>e.id===p.id));for(;;){const n=a[h],r=d[h],i=Lt(n,r-(Math.abs(e)-Math.abs(u)),t);if(r!==i&&(u+=r-i,l[h]=i,u.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--h<0)break}else if(++h>=a.length)break}return 0===u?d:(p=e<0?r:n,h=a.findIndex((e=>e.id===p.id)),l[h]=d[h]+u,l)}(h/n.current.getBoundingClientRect().width*100,i,a,c,l.current,f.current),g=m.some(((e,t)=>e!==v[t]));g&&s(v)}),[r]);M((()=>{l.current.elements=r,l.current.panels=o,l.current.widths=a}),[r,o,a]);const w=_t();M((()=>{const{widths:e}=l.current;if(e.length===o.length)return;const t=w.get(o);if(t){const e=At(o,t,window.innerWidth);return void s(e)}const n=function(e){let t=e.length,n=100;const r=e.map((e=>e.defaultSize?(n-=e.defaultSize,t-=1,e.defaultSize):null)),i=n/t;return r.map((e=>null===e?i:e))}(o);s(n)}),[w,o]),C((()=>{a.length&&w.setDebounced(o,a)}),[w,o,a]),M((()=>{const e=new ResizeObserver((()=>{const{panels:e,widths:t}=l.current,n=At(e,t,window.innerWidth),r=t.some(((e,t)=>e!==n[t]));r&&s(n)}));return e.observe(n.current),()=>{e.disconnect()}}),[]);const y=D((()=>({activeResizer:c,drag:g,getPanelStyle:u,registerElement:p,startDragging:m,stopDragging:v,unregisterElement:h})),[c,g,u,p,m,v,h]);return e(St.Provider,{value:y,children:e(Kt,{ref:n,children:t})})};function Jt(e){const{id:t,type:n}=e;return T(t,n),null}const qt=function(t){const{children:n,setParams:r}=t,i=z((e=>{r({preview:e})}),[r]),o=D((()=>i),[i]);return e(G.Provider,{value:o,children:n})},Bt=function(t){const{children:n,params:r}=t,i=D((()=>r),[r]);return e(Q.Provider,{value:i,children:n})},Vt=function(t){const{children:n,deskParams:r,devMode:i,name:o,params:a,setParams:s}=t,c=D((()=>({deskParams:r,devMode:i,name:o,params:a,setParams:s})),[r,i,o,a,s]);return e(V.Provider,{value:c,children:n})},Gt=ye(B.iframe`
  border: 0;
  max-height: 100%;
  width: 100%;
  display: block;
`),Qt=function(t){const{fontSize:r=1,onChange:i,origin:o,padding:a=3,value:s}=t,c=_(null),[d,p]=E(void 0),[h,f]=E(void 0),v=z((e=>{p(e.currentTarget.value)}),[]),g=z((e=>{if("Enter"===e.key){if(void 0===d)return;const e=d.startsWith("/")||""===d?`${o}${d}`:d;if(!e.startsWith(o+"/")&&e!==o)return void f(`URL must start with ${o}`);const t=e===o?o+"/":e;f(void 0),p(void 0),i(t.slice(o.length)),c.current?.blur()}"Escape"===e.key&&(f(void 0),p(void 0))}),[i,o,d]),w=z((()=>{f(void 0),p(void 0)}),[]);C((()=>{f(void 0),p(void 0)}),[o,s]);const y=D((()=>({icon:se})),[]);return e(n,{children:e(m,{clearButton:h?y:void 0,customValidity:h,fontSize:r,onBlur:w,onClear:()=>{f(void 0),p(o+s)},onChange:v,onKeyDownCapture:g,padding:a,style:{zIndex:1},radius:2,ref:c,space:a,suffix:e(l,{padding:1,style:{lineHeight:0,zIndex:-1},children:e(u,{as:"a",fontSize:r,href:o+(d||s),icon:ce,padding:a-1,mode:"bleed",rel:"noreferrer",target:"_blank"})}),value:void 0===d?`${o}${s}`:d})})},Ht=ye(a),Xt=B(v)`
  & > span {
    width: 21px;
    height: 13px;
    overflow: hidden;

    & > span:nth-child(1) {
      width: 21px;
      height: 13px;
    }

    & > span:nth-child(2) {
      width: 9px;
      height: 9px;
      top: 2px;
      left: 2px;
    }
  }

  & input:checked + span {
    & > span:nth-child(2) {
      transform: translate3d(8px, 0, 0) !important;
    }
  }
`,Zt={previewDrafts:"Drafts",published:"Published",raw:"Raw"},Yt="caution",en="positive",tn={previewDrafts:me,published:ve,raw:ge},nn=I((function(r,i){const{initialUrl:s,targetOrigin:f,navigatorEnabled:m,onPathChange:v,overlayEnabled:S,params:I,perspective:j,setPerspective:$,toggleNavigator:O,toggleOverlay:M,loadersConnection:_,overlaysConnection:R,previewKitConnection:U}=r,{devMode:T}=He(),[N,W]=E("desktop"),A=g(),K=z((()=>W("desktop")),[W]),F=z((()=>W("mobile")),[W]),[J,q]=E(!0),[B,V]=E(!1),[G,Q]=E(!1),X=J||G||"connecting"===R,Z="unhealthy"===R||"disconnected"===R||"unhealthy"===_||"disconnected"===_||"unhealthy"===U||"disconnected"===U,Y=D((()=>{const{origin:e}=new URL(I.preview||"/",f);return e===location.origin?"":e}),[I.preview,f]),ee=z((()=>{"function"!=typeof i&&i?.current&&(i.current.src=`${f}${I.preview||"/"}`,Q(!0))}),[I.preview,f,i]),te=z((()=>{"function"!=typeof i&&i?.current&&(i.current.src=s.toString(),Q(!0))}),[i,s]),[ne,re]=E(!1);C((()=>{if(!J&&!G&&"connecting"===R){const e=setTimeout((()=>{re(!0)}),3e3);return()=>clearTimeout(e)}}),[R,J,G]),C((()=>{if(!J&&!G&&ne&&("connected"===R&&V(!1),"connecting"===R)){const e=setTimeout((()=>{V(!0),console.error(`Unable to connect to overlays. Make sure you're calling the 'enableOverlays' function in '@sanity/overlays' correctly, and that its 'allowStudioOrigin' property is set to '${location.origin}'`)}),H);return()=>clearTimeout(e)}}),[R,J,G,ne]);const ie=D((()=>{const e=new URL(I.preview||"/",f),{pathname:t,search:n}=we(e);return`${t}${n}`}),[I.preview,f]),oe=z((()=>{q(!1),Q(!1)}),[]);return e(be,{transition:A?{duration:0}:void 0,children:t(w,{delay:1e3,children:[e(o,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:t(a,{align:"center",gap:2,style:{minHeight:0},children:[O&&e(y,{content:e(d,{size:1,children:"Toggle navigator"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(u,{"aria-label":"Toggle navigator",fontSize:1,icon:de,mode:"bleed",onClick:O,padding:3,selected:m})}),e(y,{content:e(a,{align:"center",style:{whiteSpace:"nowrap"},children:e(l,{padding:1,children:e(d,{size:1,children:S?"Disable edit overlay":"Enable edit overlay"})})}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:e(o,{as:"label",flex:"none",padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:S?"positive":void 0,children:t(a,{align:"center",gap:2,children:[e("div",{style:{margin:-2},children:e(Xt,{checked:S,onChange:M,disabled:X})}),e(l,{children:e(d,{muted:!0,size:1,weight:"medium",children:"Edit"})})]})})}),T&&e(y,{content:e(d,{size:1,children:G?"Refreshing…":"Refresh preview"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(u,{"aria-label":"Refresh preview",fontSize:1,icon:le,mode:"bleed",loading:G,onClick:ee,padding:3})}),e(l,{flex:1,children:e(Qt,{onChange:v,origin:Y,value:ie})}),e(a,{align:"center",flex:"none",gap:1,children:e(b,{button:e(u,{fontSize:1,iconRight:ue,mode:"bleed",padding:3,space:2,text:Zt[j],loading:X||"connecting"===_&&"connected"!==U,disabled:"connected"!==_}),id:"perspective-menu",menu:t(k,{style:{maxWidth:240},children:[e(P,{fontSize:1,onClick:()=>$("previewDrafts"),padding:3,pressed:"previewDrafts"===j,tone:Yt,children:t(a,{align:"flex-start",gap:3,children:[e(l,{flex:"none",children:e(d,{size:1,children:L(tn.previewDrafts)})}),t(c,{flex:1,space:2,children:[e(d,{size:1,weight:"medium",children:Zt.previewDrafts}),e(d,{muted:!0,size:1,children:"View this page with latest draft content"})]}),e(l,{flex:"none",children:e(d,{muted:!0,size:1,style:{opacity:"previewDrafts"===j?1:0},children:e(pe,{})})})]})}),e(P,{fontSize:1,onClick:()=>$("published"),padding:3,pressed:"published"===j,tone:en,children:t(a,{align:"flex-start",gap:3,children:[e(l,{flex:"none",children:e(d,{size:1,children:L(tn.published)})}),t(c,{flex:1,space:2,children:[e(d,{size:1,weight:"medium",children:Zt.published}),e(d,{muted:!0,size:1,children:"View this page with published content"})]}),e(l,{flex:"none",children:e(d,{muted:!0,size:1,style:{opacity:"published"===j?1:0},children:e(pe,{})})})]})})]}),popover:{constrainSize:!0,placement:"bottom",portal:!0}})}),t(a,{align:"center",flex:"none",gap:1,children:[e(y,{content:e(d,{size:1,children:"Full viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(u,{"aria-label":"Full viewport",fontSize:1,icon:he,mode:"bleed",onClick:K,padding:3,selected:"desktop"===N})}),e(y,{content:e(d,{size:1,children:"Narrow viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(u,{"aria-label":"Narrow viewport",fontSize:1,icon:fe,mode:"bleed",onClick:F,padding:3,selected:"mobile"===N})})]})]})}),e(o,{flex:1,tone:"transparent",children:t(a,{align:"center",height:"fill",justify:"center",padding:"desktop"===N?0:2,sizing:"border",style:{position:"relative",cursor:X?"wait":void 0},children:[e(ke,{children:Z||J||G||!ne||"connecting"!==_?J||X?e(Ht,{initial:"initial",animate:"animate",exit:"exit",variants:on,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:t(a,{style:{...rn[N]},justify:"center",align:"center",direction:"column",gap:4,children:[e(x,{muted:!0}),e(d,{muted:!0,size:1,children:"Loading…"})]})}):Z&&!X?e(Ht,{initial:"initial",animate:"animate",exit:"exit",variants:an,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-shadow-outline-color)"},children:e(Qe,{flex:1,message:"Could not connect to the preview",onRetry:te,children:T&&t(n,{children:[("unhealthy"===R||"disconnected"===R)&&e(o,{padding:3,radius:2,tone:"critical",children:t(c,{space:3,children:[e(h,{muted:!0,size:0,children:"Overlay connection status"}),e(p,{size:1,children:R})]})}),("unhealthy"===_||"disconnected"===_)&&e(o,{padding:3,radius:2,tone:"critical",children:t(c,{space:3,children:[e(h,{muted:!0,size:0,children:"Loader connection status"}),e(p,{size:1,children:_})]})})]})})}):null:e(Ht,{initial:"initial",animate:"animate",exit:"exit",variants:on,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:B?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",zIndex:1},children:e(a,{style:{...rn[N]},justify:"center",align:"center",children:e(o,{radius:2,tone:B?"caution":"inherit",padding:4,shadow:1,children:t(a,{justify:"center",align:"center",direction:"column",gap:4,children:[e(x,{muted:!0}),e(d,{muted:!0,size:1,children:B?e(n,{children:"Unable to connect, check the browser console for more information."}):"Connecting…"})]})})})})}),e(Gt,{ref:i,style:{pointerEvents:X?"none":"auto",boxShadow:"0 0 0 1px var(--card-shadow-outline-color)",borderTop:"1px solid transparent"},src:s.toString(),initial:["background"],variants:sn,animate:[J||X?"background":"active",G?"reloading":"idle",N,ne?"timedOut":""],onLoad:oe})]})})]})})})),rn={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},on={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},an={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},sn={desktop:{...rn.desktop,boxShadow:"0 0 0 0px var(--card-shadow-outline-color)"},mobile:{...rn.mobile,boxShadow:"0 0 0 1px var(--card-shadow-outline-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};function cn(e){if(void 0===e)return{id:void 0,path:void 0};const t=e?.split(".");return"drafts"===t[0]&&t.shift(),{id:t[0],path:t.length>1?i.toString(qe(t.slice(1).join("."))):void 0}}function dn(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e&&""!==e&&null!==e)))}function ln({initialPreviewUrl:e,routerNavigate:t,routerState:n,routerSearchParams:r}){const[o,a]=E((()=>{const{id:t,path:i}=cn(n.path&&decodeURIComponent(n.path));return{id:t,type:n.type,path:i,preview:r.preview||`${e.pathname}${e.search}`,perspective:r.perspective,inspect:r.inspect,rev:r.rev,since:r.since,template:r.template,view:r.view,pathKey:r.pathKey,instruction:r.instruction,comment:r.comment}})),s=z((e=>{a((t=>{const n={...t,...e};return Pe(dn(t),dn(n))?t:n}))}),[]),c=D((()=>dn({inspect:o.inspect,path:o.path,rev:o.rev,since:o.since,template:o.template,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment})),[o.inspect,o.path,o.rev,o.since,o.template,o.view,o.pathKey,o.instruction,o.comment]);C((()=>{const{type:t}=n,{id:i,path:o}=cn(n.path),a=setTimeout((()=>s({id:i,type:"*"===t?void 0:t,path:o,preview:r.preview||`${e.pathname}${e.search}`,perspective:r.perspective,inspect:r.inspect,rev:r.rev,since:r.since,template:r.template,view:r.view,pathKey:r.pathKey,instruction:r.instruction,comment:r.comment})),0);return()=>clearTimeout(a)}),[e,r,n,s]);const d=D((()=>jt(((e,n)=>{const r=dn(e);t(r,n)}),50)),[t]),l=_(o.preview);return C((()=>{const e=l.current;l.current=o.preview;const t=o.type,n=o.id?function(e){let t="";for(const n of e)"string"!=typeof n?"number"!=typeof n?Ae(n)?(t&&(t+=":"),t+=`${n.join(",")}}`):n._key&&(t&&(t+=":"),t+=`${n._key}`):(t&&(t+=":"),t+=`${n}`):(t&&(t+="."),t+=n);return t}(i.fromString([o.id,o.path].filter(Boolean).join("."))):void 0,r=dn({preview:o.preview,perspective:"published"===o.perspective?"published":void 0,inspect:o.inspect,rev:o.rev,since:o.since,template:o.template,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment}),a=o.preview===e,s=setTimeout((()=>d({type:t,path:n,_searchParams:Object.entries(r)},{replace:a})),0);return()=>clearTimeout(s)}),[d,o]),{navigate:d,setParams:s,deskParams:c,params:o}}function un(e,t,n){const r=N({apiVersion:"2023-10-16"}),[i]=E((()=>e)),o=W(),a=D((()=>"object"==typeof i?Se(i):i),[i]),[s]=E((()=>"string"==typeof a&&n?new URL(n,new URL(a,location.origin)):null)),c=function(e,t){const n=A(),r=n?.activeWorkspace?.basePath;return["@sanity/presentation",r,n?.activeWorkspace?.name||"default",e,t,pn]}(t,o?.id),d="function"==typeof a?Ie((async()=>{const{secret:e}=await xe(r,"@sanity/presentation","undefined"==typeof window?"":location.href,o?.id);return a({client:r,previewUrlSecret:e,previewSearchParam:n})}),c):s||a;return D((()=>new URL(d,location.origin)),[d])}const pn=Symbol();function hn(r){const{minWidth:i,maxWidth:o,component:a}=r,s=null!=i&&null!=o&&i===o;return t(n,{children:[e(zt,{id:"navigator",minWidth:i,maxWidth:o,order:1,children:e(a,{})}),e(Ct,{order:2,disabled:s})]})}const fn=B(a)`
  overflow-x: auto;
`;function mn(r){const{previewUrl:o,components:s}=r.tool.options??{},c=r.tool.name||X,{unstable_navigator:d}=s||{},{navigate:l,state:u}=q(),p=R(Object.fromEntries(u._searchParams||[])),h=un(o||"/",c,p.preview||null),[f]=E((()=>{const e=r.tool.options?.devMode;return"function"==typeof e?e():"boolean"==typeof e?e:"undefined"!=typeof window&&"localhost"===window.location.hostname})),m=D((()=>h.origin),[h.origin]),v=_(null),[g,w]=E(),[y,b]=E({}),{setParams:k,params:P,deskParams:x}=ln({initialPreviewUrl:h,routerNavigate:l,routerState:u,routerSearchParams:p}),[S,I]=E((()=>"published"===P.perspective?P.perspective:"previewDrafts")),[j,$]=function(e){const[t,n]=E((()=>({published:new Map,previewDrafts:new Map,raw:new Map}))),r=z(((e,t)=>{n((n=>{let r=!1,i=n[e];const o=e=>`${e._projectId}-${e.dataset}-${e._type}-${e._id}`,a=new Set;for(const e of t){const t=o(e);a.add(t),i.has(t)||(i.set(t,e),r=!0)}for(const e of i.keys())a.has(e)||(i.delete(e),r=!0);return r?(i=new Map(i),{...n,[e]:new Map(i)}):n}))}),[]),i=D((()=>t[e]),[e,t]);return[D((()=>[...i.values()]),[i]),r]}(S),[O,M]=E(!0),L=!!d?.component,[T,N]=function(e,t){const[n,r]=E((()=>JSON.parse(localStorage.getItem(e)??JSON.stringify(t))));return C((()=>{localStorage.setItem(e,JSON.stringify(n))}),[e,n]),[n,r]}("presentation/navigator",L),W=K(),A=F(),J=_(),B=_(P.id),V=D((()=>{if(L)return()=>N((e=>!e))}),[L,N]),[G,Q]=E((()=>j.slice(0,3).map((e=>({...e,_id:U(e._id)})))));C((()=>{S!==P.perspective&&k({perspective:S})}),[P.perspective,S,k]),C((()=>{Q(j.slice(0,3).map((e=>({...e,_id:U(e._id)}))))}),[j]),C((()=>{P.id!==B.current&&(B.current=P.id,P.id&&Q((e=>e.find((e=>e._id===P.id))?e:e.slice(1).concat([{_id:P.id,_type:P.type}]))))}),[P]);const[H,Z]=E("fresh"),[Y,ee]=E("fresh"),[te,ne]=E("fresh");C((()=>{const e=v.current?.contentWindow;if(!e)return;const t=We({id:"presentation",onStatusUpdate(e,t,n){"loaders"===n.config.id&&ee(e),"overlays"===n.config.id&&Z(e),"preview-kit"===n.config.id&&ne(e)},connections:[{target:e,targetOrigin:m,id:"overlays",heartbeat:!0},{target:e,targetOrigin:m,id:"loaders",heartbeat:!0},{target:e,targetOrigin:m,id:"preview-kit",heartbeat:!0}],handler(e,t){if("overlay/focus"===e&&"id"in t)k({id:t.id,path:t.path,type:t.type});else if("overlay/navigate"===e){if(J.current!==t.url){const e=void 0===J.current;J.current=t.url,k(e?{preview:t.url}:{id:void 0,type:void 0,preview:t.url})}}else"overlay/toggle"===e?M(t.enabled):"loader/documents"===e||"preview-kit/documents"===e&&t.projectId===W&&t.dataset===A?$(t.perspective,t.documents):"loader/query-listen"===e&&t.projectId===W&&t.dataset===A&&b((e=>{return{...e,[(n=t.query,r=t.params,`${n}-${"string"==typeof r?r:JSON.stringify(r)}`)]:{perspective:t.perspective,query:t.query,params:t.params}};var n,r}))}});return w(t),()=>{t.disconnect(),w(void 0)}}),[A,W,$,k,m]);const re=z(((e,t)=>{k({path:i.toString(t)})}),[k]),ie=z((e=>{const t=new URL(e,h.origin),n=t.pathname+t.search;t.origin===h.origin&&n!==P.preview&&k({id:void 0,path:void 0,preview:n})}),[h,P,k]),oe=z((e=>{k({...e})}),[k]);C((()=>{P.id&&P.path?g?.send("presentation/focus",{id:P.id,path:P.path}):g?.send("presentation/blur",void 0)}),[g,P.id,P.path]),C((()=>{J.current&&P.preview&&J.current!==P.preview&&(J.current=P.preview,g?.send("presentation/navigate",{url:P.preview,type:"push"}))}),[g,P.preview]);const ae=z((()=>g?.send("presentation/toggleOverlay",void 0)),[g]),[se,ce]=E(null),de=z((e=>ce(e)),[]);return C((()=>{const e=e=>{Ge(e)&&ae()},t=e=>{Ge(e)&&ae(),Ve(["mod","\\"],e)&&ae()};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}}),[ae]),t(n,{children:[t(Vt,{deskParams:x,devMode:f,name:c,params:P,setParams:k,children:[G.map((t=>e(Jt,{id:t._id,type:t._type},t._id))),e(qt,{setParams:k,children:e(Bt,{params:P,children:e(fn,{height:"fill",children:t(Ft,{children:[L&&T&&e(hn,{...d}),e(zt,{id:"preview",minWidth:325,defaultSize:T?50:75,order:3,children:e(a,{direction:"column",flex:1,height:"fill",children:e(nn,{initialUrl:h,navigatorEnabled:T,onPathChange:ie,overlayEnabled:O,params:P,perspective:S,ref:v,setPerspective:I,targetOrigin:m,toggleNavigator:V,toggleOverlay:ae,loadersConnection:Y,overlaysConnection:H,previewKitConnection:te})})}),e(Ct,{order:4}),e(zt,{id:"content",minWidth:325,order:5,children:e(dt,{refs:j,deskParams:x,documentId:P.id,documentType:P.type,onDeskParams:oe,onFocusPath:re,onDocumentChange:de,previewUrl:P.preview})})]})})})})]}),g&&t(n,{children:[e(Pt,{activePerspective:"published"===S,channel:g,liveQueries:y,perspective:"published",liveDocument:se?._id?.startsWith("drafts.")?null:se},"published"),e(Pt,{activePerspective:"previewDrafts"===S,channel:g,liveQueries:y,perspective:"previewDrafts",liveDocument:se},"previewDrafts")]})]})}export{mn as default};//# sourceMappingURL=PresentationTool-ocAgrSyq.js.map
