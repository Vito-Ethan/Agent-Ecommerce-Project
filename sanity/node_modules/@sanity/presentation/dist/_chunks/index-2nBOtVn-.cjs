"use strict";var e=require("react/jsx-runtime"),t=require("react"),n=require("sanity"),r=require("@sanity/icons"),s=require("@sanity/ui"),i=require("sanity/router"),o=require("rxjs");const a=r.ComposeIcon,c="presentation",u="Presentation",l=t.createContext(null),d={locations:[]};const m={1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"},p={positive:r.InfoOutlineIcon,caution:r.WarningOutlineIcon,critical:r.ErrorOutlineIcon};function x(i){const{documentId:a,options:x,schemaType:f,showPresentationTitle:j}=i,g=t.useContext(l),{message:y,locations:T,tone:I}=function(e){const{id:r,locate:s,type:i}=e,a=n.useDocumentStore(),[c,u]=t.useState(d);return t.useEffect((()=>{if(!s)return;const e=s({id:r,type:i},{documentStore:a}),t=(o.isObservable(e)?e:o.of(e)).subscribe((e=>u(e||d)));return()=>t.unsubscribe()}),[a,r,s,i]),c}({id:a,locate:x.locate,type:f.name}),v=T?.length||0,[C,b]=t.useState(!1),S=t.useCallback((()=>b((e=>!e))),[]),P=y||(v?e.jsxs(e.Fragment,{children:["Used on ",m[v]||v," ",1===v?e.jsx(e.Fragment,{children:"page"}):e.jsx(e.Fragment,{children:"pages"})]}):null);return 0!==v||P?e.jsx(s.Card,{padding:1,radius:3,border:!0,tone:I,children:e.jsxs("div",{style:{margin:-1},children:[!T&&e.jsxs(s.Flex,{align:"flex-start",gap:3,padding:3,children:[I&&e.jsx(s.Box,{flex:"none",children:e.jsx(s.Text,{size:1,children:t.createElement(p[I])})}),e.jsx(s.Box,{flex:1,children:e.jsxs(s.Text,{size:1,weight:"medium",children:[j&&e.jsxs(e.Fragment,{children:[x.title||u," · "]}),P]})})]}),T&&e.jsxs(e.Fragment,{children:[e.jsx(s.Card,{as:"button",onClick:S,padding:3,radius:2,tone:"inherit",children:e.jsxs(s.Flex,{gap:3,children:[e.jsx(s.Box,{flex:"none",children:e.jsx(s.Text,{size:1,children:e.jsx(r.ChevronRightIcon,{style:{transform:`rotate(${C?"90deg":0})`,transition:"transform 100ms ease-in-out"}})})}),e.jsx(s.Box,{flex:1,children:e.jsxs(s.Text,{size:1,weight:"medium",children:[j&&e.jsxs(e.Fragment,{children:[x.title||u," · "]}),P]})})]})}),e.jsx(s.Stack,{hidden:!C,marginTop:1,space:1,children:T.map(((t,n)=>e.jsx(h,{active:(x.name||c)===g?.name&&t.href===g?.params.preview,documentId:a,documentType:f.name,node:t,toolName:x.name||c},n)))})]})]})}):null}function h(n){const{documentId:o,documentType:a,node:c,active:u,toolName:d}=n,m=t.useContext(l),p=m?.setParams,x=i.useIntentLink({intent:"edit",params:{id:o,type:a,mode:"presentation",presentation:d,...m?.deskParams,preview:c.href}}),h=t.useCallback((()=>{p?.({...m?.params,preview:c.href})}),[c.href,m?.params,p]);return t.createElement(s.Card,{...m?{}:x,as:m?"button":"a",key:c.href,onClick:h,padding:3,radius:2,pressed:u,tone:"inherit"},e.jsxs(s.Flex,{gap:3,children:[e.jsx(s.Box,{flex:"none",children:e.jsx(s.Text,{size:1,children:e.jsx(r.DesktopIcon,{})})}),e.jsxs(s.Stack,{flex:1,space:2,children:[e.jsx(s.Text,{size:1,weight:"medium",children:c.title}),e.jsx(s.Text,{muted:!0,size:1,textOverflow:"ellipsis",children:c.href})]})]}))}function f(r){const{documentId:i,schemaType:o}=r,a=n.useEditState(i,o.name),c=n.useConnectionState(i,o.name),u=a.draft||a.published,l=u?._id||i,{error:d,value:m,isLoading:p}=n.unstable_useValuePreview({enabled:"connected"===c,schemaType:o,value:t.useMemo((()=>({_type:"reference",_ref:l})),[l])}),x=o.title||o.name,h=m?.title;return d||p?null:e.jsxs(s.Stack,{space:3,children:[x!==h&&e.jsx(s.Text,{muted:!0,size:1,children:x}),e.jsx(s.Heading,{as:"h1",muted:!m?.title,size:3,children:m?.title||e.jsx("em",{children:"Untitled"})})]})}const j=t.createContext(null);function g(n){const{documentId:r,options:i,schemaType:o}=n,a=t.useContext(j);if(a&&a.options[0]!==i)return null;const c=a?.options?.length||0;return e.jsxs(s.Stack,{marginBottom:5,space:5,children:[e.jsx(f,{documentId:r,options:i,schemaType:o}),e.jsx(s.Stack,{space:2,children:a?.options.map(((t,n)=>e.jsx(x,{documentId:r,options:t,schemaType:o,showPresentationTitle:c>1},n)))})]})}function y(n){const{children:r,options:s}=n,i=t.useContext(j),o=i?.register,[a,c]=t.useState((()=>[])),u=t.useCallback((e=>o?o(e):(c((t=>[e].concat(t))),()=>{c((t=>t.filter((t=>t!==e))))})),[o]),l=t.useRef(u);l.current=u;const d=t.useMemo((()=>({options:i?.options||a,register:u})),[a,i,u]);return t.useEffect((()=>l.current(s)),[s]),e.jsx(j.Provider,{value:d,children:r})}const T=n.defineDocumentFieldAction({name:"presentation/openInStructure",useAction({documentId:e,documentType:s,path:o}){const a=n.useWorkspace(),{navigateIntent:c}=i.useRouter(),u=t.useContext(l),d=t.useMemo((()=>function(e,t,r){const s=e.map((e=>{const n=e.canHandleIntent?.("edit",{id:t,type:r,mode:"structure"},{});return{tool:e,match:n}})),i=s.filter((e=>n.isRecord(e.match)&&e.match.mode));if(i.length>0)return i[0].tool;const o=s.filter((e=>e.match));return o[0]?.tool}(a.tools,e,s)),[e,s,a.tools]);return{type:"action",hidden:!u||o.length>0||!d,icon:d?.icon||r.MasterDetailIcon,title:`Open in ${d?.title||"Structure"}`,onAction(){c("edit",{id:e,type:s,mode:"structure",path:n.pathToString(o)})},renderAsButton:!0}}});function I(e,t,r,s){const{id:i,mode:o,path:a,presentation:c,type:u,...l}=t;return"edit"===e&&i?{type:u||"*",path:[n.getPublishedId(i),a].filter(Boolean).join("."),_searchParams:Object.entries(l)}:{intent:e,params:t,payload:s}}const v=i.route.create("/",{__unsafe_disableScopedSearchParams:!0},[i.route.intents("/intent"),i.route.create("/:type",[i.route.create("/:path")])]),C=n.definePlugin((r=>{const s=r.name||c;return{document:{unstable_fieldActions:e=>[...e.filter((e=>e.name!==T.name)),T]},form:{components:{input:function(t){const s=t.value,i=s?._id?n.getPublishedId(s?._id):void 0;return n.isDocumentSchemaType(t.schemaType)?e.jsxs(y,{options:r,children:[i&&e.jsx(g,{documentId:i,options:r,schemaType:t.schemaType}),t.renderDefault(t)]}):t.renderDefault(t)}}},tools:[{icon:r.icon||a,name:s,title:r.title,component:t.lazy((()=>Promise.resolve().then((function(){return require("./PresentationTool-89YWZAjN.cjs")})))),options:r,canHandleIntent(e,t){if("edit"===e){if(!t.id)return!1;if(t.presentation&&t.presentation!==s)return!1;if(!t.mode)return!0;if("presentation"===t.mode)return{mode:!0}}return!1},getIntentState:I,router:v}]}})),b=t.createContext(null);const S=t.createContext(null);exports.D=c,exports.M=3e3,exports.P=l,exports.a=b,exports.b=S,exports.c=function(){const e=t.useContext(S);if(!e)throw new Error("Presentation params context is missing");return e},exports.p=C,exports.u=function(){const e=t.useContext(b);if(!e)throw new Error("Presentation navigate context is missing");return e};//# sourceMappingURL=index-2nBOtVn-.cjs.map
